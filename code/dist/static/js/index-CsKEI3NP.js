import{i as C}from"./comm-DyJRlPK0.js";import{c as Z,r as ee,e as U}from"./index-CmZ4zCGF.js";import"./store@2.0.12-RoMfFez2.js";import{u as R}from"./index-CO9VWbz1.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{v as te,w as oe}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{U as ne,V as re,E as le}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import{u as Q}from"./group-Bd5rxP0u.js";import{b as A,a as x}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{q as se}from"./lodash-es@4.17.21-D6PnhKvy.js";import{d as T,o as ae,_ as i,a0 as X,a as I,c as O,f as k,i as o,L as p,O as J,M as L,P as z,K as G,n as ie}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{r as P,v}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{p as pe,O as ce}from"./@vue_shared@3.5.12-UFe9jxSY.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@braintree_sanitize-url@6.0.4-BB1FEM6a.js";import"./vue@3.5.12_typescript@5.5.4-kKmasoJt.js";import"./@vueuse_core@11.1.0_vue@3.5.12_typescript@5.5.4_-BKaerpSy.js";import"./@vueuse_shared@11.1.0_vue@3.5.12_typescript@5.5.4_-DXriuop5.js";import"./mitt@3.0.1-C1z4c41a.js";import"./axios@1.7.7-CCb-kr4I.js";import"./nprogress@0.2.0-B8S133N7.js";import"./pinia@2.2.4_typescript@5.5.4_vue@3.5.12_typescript@5.5.4_-CVf9nHlw.js";import"./vue-demi@0.14.10_vue@3.5.12_typescript@5.5.4_-DvPnGcuI.js";import"./@bytemd_plugin-math@1.21.0_bytemd@1.21.0-Dc_JUVYX.js";import"./remark-math@5.1.1-C8vps_rM.js";import"./micromark-extension-math@2.1.2-StTlgfH1.js";import"./micromark-factory-space@1.1.0-C57A7NS2.js";import"./micromark-util-character@1.2.0-D-NaLusr.js";import"./katex@0.16.11-CvgdMzdh.js";import"./mdast-util-math@2.0.2-Boy2OOKg.js";import"./longest-streak@3.1.0-BHNUWYJP.js";import"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";import"./micromark-util-decode-string@1.1.0-CdHYbWAu.js";import"./decode-named-character-reference@1.0.2-C3-224fz.js";import"./micromark-util-decode-numeric-character-reference@1.1.0-DRnCnno4.js";import"./vue-router@4.4.5_vue@3.5.12_typescript@5.5.4_-DGEeQixy.js";import"./mockjs@1.1.0-hXCvQ4kl.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.12_echarts@5.5.1_vue@3.5.12_typescript@5.5.4_-tmE62Ovn.js";import"./echarts@5.5.1-D8FyPvXx.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.0-CH1asNwC.js";import"./@vueuse_shared@9.13.0_vue@3.5.12_typescript@5.5.4_-u9BR5ga7.js";import"./@vueuse_core@9.13.0_vue@3.5.12_typescript@5.5.4_-B3H9WZsa.js";import"./@sxzz_popperjs-es@2.11.7-DkudPAZk.js";import"./@ctrl_tinycolor@3.6.1--gef7wIN.js";import"./dayjs@1.11.13-DXimfR00.js";import"./async-validator@4.2.5-DbzRl2Zc.js";import"./memoize-one@6.0.0-DQFWdy6B.js";import"./normalize-wheel-es@1.2.0-D2sExr9L.js";import"./@floating-ui_dom@1.6.11-Db5K7U0i.js";import"./@floating-ui_core@1.6.8-B67JZAQv.js";import"./@floating-ui_utils@0.2.8-BSxVqCX2.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-D8rsWRp7.js";const de={class:"dept-tree"},ue={class:"dept-tree__header"},_e={class:"dept-tree__op"},fe={class:"no"},be={class:"dept-tree__node"},ve=["onClick"],he=T({name:"dept-list"}),ge=T({...he,props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["refresh","user-add"],setup(q,{emit:g}){const D=q,N=g,{service:_,browser:y}=R(),h=C.useForm(),{ViewGroup:m}=Q(),d=P([]),w=P(!1),f=P(!1);function l({data:t}){return t.parentId}function n(t,e){return e.data.parentId}async function c(){w.value=!0,f.value=!1,await _.base.sys.department.list().then(t=>{var e;d.value=Z(t),(e=m.value)!=null&&e.selected||b()}),w.value=!1}function b(t){var e;if(t||(t=d.value[0]),t){const s=t.children?ee(t.children).map(r=>r.id):[];s.unshift(t.id),(e=m.value)==null||e.select(t),ie(()=>{N("refresh",{page:1,departmentIds:s})})}}function E(t){var s;const e=t.id?"update":"add";(s=h.value)==null||s.open({title:"编辑部门",width:"550px",props:{labelWidth:"100px"},items:[{label:"部门名称",prop:"name",component:{name:"el-input"},required:!0},{label:"上级部门",prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:"排序",prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...t},on:{submit(r,{done:a,close:u}){_.base.sys.department[e]({id:t.id,parentId:t.parentId,name:r.name,orderNum:r.orderNum}).then(()=>{x.success(`新增部门 “${r.name}” 成功`),u(),c()}).catch($=>{x.error($.message),a()})}}})}function F(t){async function e(s){await _.base.sys.department.delete({ids:[t.id],deleteUser:s}).then(()=>{var r,a;((a=(r=m.value)==null?void 0:r.selected)==null?void 0:a.id)==t.id&&b(),s?x.success("删除成功"):A.confirm(`“${t.name}” 部门的用户已成功转移到 “${t.parentName}” 部门。`,"删除成功")}),c()}A.confirm(`此操作将会删除 “${t.name}” 部门的所有用户，是否确认？`,"提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then(()=>{e(!0)}).catch(s=>{s=="cancel"&&e(!1)})}function V(t){t?A.confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then(async()=>{const e=[];function s(r,a){r.forEach(u=>{u.parentId=a,e.push(u),u.children&&se(u.children)&&s(u.children,u.id)})}s(d.value,null),await _.base.sys.department.order(e.map((r,a)=>({id:r.id,parentId:r.parentId,orderNum:a}))).then(()=>{x.success("更新排序成功")}).catch(r=>{x.error(r.message)}),c(),f.value=!1}).catch(()=>null):c()}function B(t,e,s){e||(e=d.value[0]||{});const r=_.base.sys.department.permission;C.ContextMenu.open(t,{list:[{label:"新增",hidden:s&&s.level>=D.level||!U(r.add),callback(a){E({name:"",parentName:e.name,parentId:e.id}),a()}},{label:"编辑",hidden:!U(r.update),callback(a){E(e),a()}},{label:"删除",hidden:!e.parentId||!U(r.delete),callback(a){F(e),a()}},{label:"新增成员",hidden:!U(r.add),callback(a){N("user-add",e),a()}}]})}return ae(function(){c()}),(t,e)=>{const s=i("el-icon"),r=i("el-tooltip"),a=i("el-button"),u=i("el-tree"),$=i("el-scrollbar"),M=i("cl-form"),S=X("loading");return I(),O("div",de,[k("div",ue,[e[6]||(e[6]=k("div",null,"组织架构",-1)),k("ul",_e,[k("li",{onClick:e[0]||(e[0]=W=>c())},[o(r,{content:"刷新"},{default:p(()=>[o(s,null,{default:p(()=>[o(v(ne))]),_:1})]),_:1})]),q.drag&&!v(y).isMini?(I(),O("li",{key:0,onClick:e[1]||(e[1]=W=>f.value=!0)},[o(r,{content:"拖动排序"},{default:p(()=>[o(s,null,{default:p(()=>[o(v(re))]),_:1})]),_:1})])):J("",!0),L(k("li",fe,[o(a,{size:"small",onClick:e[2]||(e[2]=W=>V(!0))},{default:p(()=>e[4]||(e[4]=[z("保存")])),_:1}),o(a,{size:"small",onClick:e[3]||(e[3]=W=>V(!1))},{default:p(()=>e[5]||(e[5]=[z("取消")])),_:1})],512),[[te,f.value]])])]),k("div",{class:"dept-tree__container",onContextmenu:oe(B,["stop","prevent"])},[o($,null,{default:p(()=>[L((I(),G(u,{"node-key":"id","default-expand-all":"",data:d.value,props:{label:"name"},"highlight-current":"",draggable:f.value,"allow-drag":l,"allow-drop":n,"expand-on-click-node":!1,onNodeContextmenu:B,onNodeClick:b},{default:p(({node:W,data:K})=>{var j,H;return[k("div",be,[k("span",{class:pe(["dept-tree__node-label",{"is-active":K.id==((H=(j=v(m))==null?void 0:j.selected)==null?void 0:H.id)}])},ce(W.label),3),v(y).isMini?(I(),O("span",{key:0,class:"dept-tree__node-icon",onClick:Y=>B(Y,K,W)},[o(s,null,{default:p(()=>[o(v(le))]),_:1})],8,ve)):J("",!0)])]}),_:1},8,["data","draggable"])),[[S,w.value]])]),_:1})],32),o(M,{ref_key:"Form",ref:h},null,512)])}}}),ye=me(ge,[["__scopeId","data-v-89cdde12"]]),we={class:"dept-move"},ke=T({name:"user-move"}),xe=T({...ke,setup(q,{expose:g}){const{service:D}=R(),N=C.useForm(),_=C.useCrud();async function y(h){var m;(m=N.value)==null||m.open({title:"部门转移",width:"500px",props:{labelWidth:"80px"},items:[{label:"选择部门",prop:"departmentId",component:{name:"cl-dept-select"}}],on:{submit(d,{done:w,close:f}){if(!d.departmentId)return x.warning("请选择部门"),w();A.confirm("转移到新部门，是否继续？","提示",{type:"warning"}).then(()=>{D.base.sys.user.move({...d,userIds:h}).then(()=>{var l;x.success("转移成功"),(l=_.value)==null||l.refresh(),f()}).catch(l=>{x.error(l.message),w()})}).catch(()=>null)}}})}return g({open:y}),(h,m)=>{const d=i("cl-form");return I(),O("div",we,[o(d,{ref_key:"Form",ref:N},null,512)])}}}),Ce=T({name:"sys-user"}),It=T({...Ce,setup(q){const{service:g,refs:D,setRefs:N}=R(),{ViewGroup:_}=Q({title:"用户列表"}),y=C.useCrud({service:g.base.sys.user}),h=C.useTable({columns:[{type:"selection",width:60},{prop:"headImg",label:"头像",component:{name:"cl-avatar"}},{prop:"username",label:"用户名",minWidth:150},{prop:"name",label:"姓名",minWidth:150},{prop:"nickName",label:"昵称",minWidth:150},{prop:"departmentName",label:"部门名称",minWidth:150},{prop:"roleName",label:"角色",headerAlign:"center",minWidth:150,dict:[],formatter(l){var n;return(n=l.roleName)==null?void 0:n.split(",")}},{prop:"status",label:"状态",minWidth:120,component:{name:"cl-switch"}},{prop:"phone",label:"手机号码",minWidth:150},{prop:"remark",label:"备注",minWidth:150},{prop:"createTime",label:"创建时间",sortable:"desc",minWidth:170},{type:"op",buttons:["slot-btn","edit","delete"],width:240}]}),m=C.useUpsert({dialog:{width:"800px"},items:[{prop:"headImg",label:"头像",component:{name:"cl-upload",props:{text:"选择头像"}}},{prop:"name",label:"姓名",span:12,required:!0,component:{name:"el-input"}},{prop:"nickName",label:"昵称",required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:"用户名",required:!0,span:12,component:{name:"el-input"}},()=>{var l;return{prop:"password",label:"密码",span:12,required:((l=m.value)==null?void 0:l.mode)=="add",component:{name:"el-input",props:{type:"password"}},rules:[{min:6,max:16,message:"密码长度在 6 到 16 个字符"}]}},{prop:"roleIdList",label:"角色",value:[],required:!0,component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}},{prop:"phone",label:"手机号码",span:12,component:{name:"el-input"}},{prop:"email",label:"邮箱",span:12,component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:"状态",value:1,component:{name:"el-radio-group",options:[{label:"开启",value:1},{label:"关闭",value:0}]}}],onSubmit(l,{next:n}){var c,b;n({departmentId:(b=(c=_.value)==null?void 0:c.selected)==null?void 0:b.id,...l})},async onOpen(){g.base.sys.role.list().then(l=>{var n;(n=m.value)==null||n.setOptions("roleIdList",l.map(c=>({label:c.name||"",value:c.id})))})},plugins:[C.setFocus("name")]});function d(l){var n;(n=y.value)==null||n.refresh(l)}function w({id:l}){var n;(n=y.value)==null||n.rowAppend({departmentId:l})}async function f(l){var c;let n=[];l?n=[l.id]:n=((c=h.value)==null?void 0:c.selection.map(b=>b.id))||[],D.userMove.open(n)}return(l,n)=>{const c=i("cl-refresh-btn"),b=i("cl-add-btn"),E=i("cl-multi-delete-btn"),F=i("el-button"),V=i("cl-flex1"),B=i("cl-search-key"),t=i("cl-row"),e=i("cl-table"),s=i("cl-pagination"),r=i("cl-upsert"),a=i("cl-crud"),u=i("cl-view-group"),$=X("permission");return I(),G(u,{ref_key:"ViewGroup",ref:_},{left:p(()=>[o(ye,{onRefresh:d,onUserAdd:w})]),right:p(()=>[o(a,{ref_key:"Crud",ref:y},{default:p(()=>[o(t,null,{default:p(()=>{var M;return[o(c),o(b),o(E),L((I(),G(F,{type:"success",disabled:((M=v(h))==null?void 0:M.selection.length)==0,onClick:n[0]||(n[0]=S=>f())},{default:p(()=>n[1]||(n[1]=[z(" 转移 ")])),_:1},8,["disabled"])),[[$,v(g).base.sys.user.permission.move]]),o(V),o(B,{placeholder:"搜索用户名、姓名"})]}),_:1}),o(t,null,{default:p(()=>[o(e,{ref_key:"Table",ref:h},{"slot-btn":p(({scope:M})=>[L((I(),G(F,{text:"",bg:"",onClick:S=>f(M.row)},{default:p(()=>n[2]||(n[2]=[z(" 转移 ")])),_:2},1032,["onClick"])),[[$,v(g).base.sys.user.permission.move]])]),_:1},512)]),_:1}),o(t,null,{default:p(()=>[o(V),o(s)]),_:1}),o(r,{ref_key:"Upsert",ref:m},null,512),o(xe,{ref:v(N)("userMove")},null,512)]),_:1},512)]),_:1},512)}}});export{It as default};
