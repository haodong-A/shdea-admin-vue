import{d as se}from"./dayjs@1.11.13-DXimfR00.js";import{u as L,a as O,m as oe}from"./index-CmZ4zCGF.js";import"./store@2.0.12-RoMfFez2.js";import{u as J}from"./index-CO9VWbz1.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{J as ne,a7 as ae,a8 as le,a9 as ie,B as ce,U as re,aa as ue,m as de}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import{y as _e,d as D,b as E,M as K,a as _,c as C,f as e,F as q,i as t,O as Y,L as c,_ as l,a0 as P,X as W,P as pe,n as X,K as F,C as me}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{d as A}from"./pinia@2.2.4_typescript@5.5.4_vue@3.5.12_typescript@5.5.4_-CVf9nHlw.js";import{r as $,v as a}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{i as G}from"./comm-DyJRlPK0.js";import{a as fe}from"./@vueuse_core@11.1.0_vue@3.5.12_typescript@5.5.4_-BKaerpSy.js";import{a as ve}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{O as U,p as R}from"./@vue_shared@3.5.12-UFe9jxSY.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as he}from"./lodash-es@4.17.21-D6PnhKvy.js";import"./@braintree_sanitize-url@6.0.4-BB1FEM6a.js";import"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import"./mitt@3.0.1-C1z4c41a.js";import"./axios@1.7.7-CCb-kr4I.js";import"./nprogress@0.2.0-B8S133N7.js";import"./@bytemd_plugin-math@1.21.0_bytemd@1.21.0-Dc_JUVYX.js";import"./remark-math@5.1.1-C8vps_rM.js";import"./micromark-extension-math@2.1.2-StTlgfH1.js";import"./micromark-factory-space@1.1.0-C57A7NS2.js";import"./micromark-util-character@1.2.0-D-NaLusr.js";import"./katex@0.16.11-CvgdMzdh.js";import"./mdast-util-math@2.0.2-Boy2OOKg.js";import"./longest-streak@3.1.0-BHNUWYJP.js";import"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";import"./micromark-util-decode-string@1.1.0-CdHYbWAu.js";import"./decode-named-character-reference@1.0.2-C3-224fz.js";import"./micromark-util-decode-numeric-character-reference@1.1.0-DRnCnno4.js";import"./vue-router@4.4.5_vue@3.5.12_typescript@5.5.4_-DGEeQixy.js";import"./mockjs@1.1.0-hXCvQ4kl.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.12_echarts@5.5.1_vue@3.5.12_typescript@5.5.4_-tmE62Ovn.js";import"./echarts@5.5.1-D8FyPvXx.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.0-CH1asNwC.js";import"./@vueuse_shared@9.13.0_vue@3.5.12_typescript@5.5.4_-u9BR5ga7.js";import"./@vueuse_core@9.13.0_vue@3.5.12_typescript@5.5.4_-B3H9WZsa.js";import"./@sxzz_popperjs-es@2.11.7-DkudPAZk.js";import"./@ctrl_tinycolor@3.6.1--gef7wIN.js";import"./async-validator@4.2.5-DbzRl2Zc.js";import"./memoize-one@6.0.0-DQFWdy6B.js";import"./normalize-wheel-es@1.2.0-D2sExr9L.js";import"./@floating-ui_dom@1.6.11-Db5K7U0i.js";import"./@floating-ui_core@1.6.8-B67JZAQv.js";import"./@floating-ui_utils@0.2.8-BSxVqCX2.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-D8rsWRp7.js";import"./vue@3.5.12_typescript@5.5.4-kKmasoJt.js";import"./@vueuse_shared@11.1.0_vue@3.5.12_typescript@5.5.4_-DXriuop5.js";import"./vue-demi@0.14.10_vue@3.5.12_typescript@5.5.4_-DvPnGcuI.js";function Z(){return{chat:_e("chat")}}const ge=A("chat-message",()=>{const p=$(!1),f=$([]),m=$({page:1,total:0,size:20});async function n(u){p.value=!0,(u==null?void 0:u.page)==1&&(f.value=[]),p.value=!1}return{loading:p,list:f,pagination:m,get:n}}),xe=A("chat-session",()=>{const p=$(!1),f=$([]),m=$();async function n(M){p.value=!0,p.value=!1}function u(M){m.value=M}return{loading:p,list:f,value:m,get:n,set:u}});function j(){const p=xe(),f=ge();return{session:p,message:f}}const ke={class:"chat-message","element-loading-text":"消息列表加载中"},ye={class:"head"},be={class:"avatar"},Ce={class:"name"},$e={class:"avatar"},we=["onContextmenu"],Me={class:"h"},Se={class:"name"},Te={class:"content"},Ve={key:0,class:"is-text"},Be={key:1,class:"is-image"},Ne={class:"footer"},Ie={class:"tools"},ze={class:"input"},Ue=D({name:"undefined"}),De=D({...Ue,setup(p){const{user:f}=L(),{chat:m}=Z(),{message:n,session:u}=j(),{copy:M}=fe(),v=$(""),w=E(()=>{let d=0;return n.list.map(s=>{var k;return s.contentType==1&&(s._index=d++),s.isMy=s.fromId==((k=f.info)==null?void 0:k.id),s})}),h=E(()=>n.list.filter(d=>d.contentType==1).map(d=>{var s;return(s=d.content)==null?void 0:s.imageUrl}).filter(Boolean));function I(){m.send({contentType:0,content:{text:v.value}},!0),v.value=""}function x(d){m.send({contentType:1,content:{imageUrl:d.url}},!0),v.value=""}function g(d,s){G.ContextMenu.open(d,{hover:{target:"content"},list:[{label:"复制",callback(k){M(s.content.text||""),ve.success("复制成功"),k()}},{label:"转发"},{label:"删除"}]})}return(d,s)=>{var y,B,N,H;const k=l("cl-avatar"),z=l("el-image"),V=l("el-scrollbar"),S=l("el-icon"),r=l("cl-upload"),i=l("el-input"),o=l("el-button"),T=P("loading");return K((_(),C("div",ke,[e("div",ye,[(y=a(u))!=null&&y.value?(_(),C(q,{key:0},[e("div",be,[t(k,{size:30,shape:"square",src:(B=a(u))==null?void 0:B.value.avatar},null,8,["src"])]),e("span",Ce,"与“"+U((N=a(u))==null?void 0:N.value.nickName)+"”聊天中",1)],64)):Y("",!0)]),t(V,{class:"list"},{default:c(()=>[e("ul",null,[(_(!0),C(q,null,W(w.value,(b,ee)=>(_(),C("li",{key:ee},[e("div",{class:R(["item",{"is-right":b.isMy}])},[e("div",$e,[t(k,{size:36,shape:"square",src:b.avatar},null,8,["src"])]),e("div",{class:"det",onContextmenu:te=>{g(te,b)}},[e("div",Me,[e("span",Se,U(b.nickName),1)]),e("div",Te,[b.contentType==0?(_(),C("div",Ve,[e("span",null,U(b.content.text),1)])):b.contentType==1?(_(),C("div",Be,[t(z,{src:b.content.imageUrl,"preview-src-list":h.value,"initial-index":b._index,"scroll-container":".chat-message .list"},null,8,["src","preview-src-list","initial-index"])])):Y("",!0)])],40,we)],2)]))),128))])]),_:1}),e("div",Ne,[e("div",Ie,[e("ul",null,[t(r,{"show-file-list":!1,onSuccess:x},{default:c(()=>[e("li",null,[t(S,null,{default:c(()=>[t(a(ne))]),_:1})])]),_:1}),e("li",null,[t(S,null,{default:c(()=>[t(a(ae))]),_:1})]),e("li",null,[t(S,null,{default:c(()=>[t(a(le))]),_:1})]),e("li",null,[t(S,null,{default:c(()=>[t(a(ie))]),_:1})])])]),e("div",ze,[t(i,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=b=>v.value=b),type:"textarea",rows:4,resize:"none",autosize:{minRows:4,maxRows:10},placeholder:"输入内容"},null,8,["modelValue"]),t(o,{type:"success",disabled:!v.value,onClick:I},{default:c(()=>s[1]||(s[1]=[pe("发送")])),_:1},8,["disabled"])])])])),[[T,(H=a(n))==null?void 0:H.loading]])}}}),qe=Q(De,[["__scopeId","data-v-4727d2bc"]]),Ee={class:"chat-session"},Ye={class:"head"},Fe={class:"tools"},Re={class:"list"},je=["onClick"],He={class:"avatar"},Le={class:"det"},Oe={class:"name"},Je={class:"message"},Ke={class:"status"},Pe={class:"date"},We=D({name:"undefined"}),Xe=D({...We,setup(p){const{browser:f}=O(),{chat:m}=Z(),{session:n,message:u}=j(),{refs:M,setRefs:v}=J();G.useDialog({onFullscreen(){X(()=>{var x;(x=M.scroller)==null||x.update()})}});const w=$(""),h=E(()=>(n==null?void 0:n.list.filter(x=>{var g;return(g=x.nickName)==null?void 0:g.includes(w.value)}))||[]);async function I(x){f.isMini&&m.expand(!1),n.set(x),await u.get({page:1}),m.scrollToBottom()}return(x,g)=>{var i;const d=l("el-input"),s=l("el-icon"),k=l("cl-avatar"),z=l("el-badge"),V=l("el-empty"),S=l("el-scrollbar"),r=P("loading");return _(),C("div",Ee,[e("div",Ye,[t(d,{modelValue:w.value,"onUpdate:modelValue":g[0]||(g[0]=o=>w.value=o),placeholder:"关键字搜索",clearable:""},null,8,["modelValue"]),e("ul",Fe,[e("li",null,[t(s,null,{default:c(()=>[t(a(ce))]),_:1})]),e("li",{onClick:g[1]||(g[1]=o=>a(n).get())},[t(s,null,{default:c(()=>[t(a(re))]),_:1})])])]),K((_(),C("div",Re,[t(S,{ref:a(v)("scroller"),class:"scroller"},{default:c(()=>[(_(!0),C(q,null,W(h.value,(o,T)=>{var y,B;return _(),C("div",{key:T,class:R(["item",{"is-active":o.id==((B=(y=a(n))==null?void 0:y.value)==null?void 0:B.id)}]),onClick:N=>I(o)},[e("div",He,[t(z,{value:o.num,hidden:o.num==0},{default:c(()=>[t(k,{shape:"square",src:o.avatar},null,8,["src"])]),_:2},1032,["value","hidden"])]),e("div",Le,[e("p",Oe,U(o.nickName),1),e("p",Je,U(o.text),1)]),e("div",Ke,[e("p",Pe,U(o.createTime),1)])],10,je)}),128)),h.value.length==0?(_(),F(V,{key:0,"image-size":100,description:"暂无会话"})):Y("",!0)]),_:1},512)])),[[r,(i=a(n))==null?void 0:i.loading]])])}}}),Ae=Q(Xe,[["__scopeId","data-v-1244a237"]]),Ge={class:"cl-chat__session"},Qe={class:"cl-chat__right"},Ze={class:"cl-dialog__controls-icon"},et=D({name:"cl-chat"}),es=D({...et,setup(p,{expose:f}){J();const{browser:m,onScreenChange:n}=O(),{session:u,message:M}=j(),{user:v}=L();oe.get("chat");const w=$(!1),h=$(!0),I=$(parseInt(String(Math.random()*100)));function x(){S()}function g(){w.value=!0,x()}function d(){w.value=!1}function s(r){h.value=r===void 0?!h.value:r}function k(r,i){i&&z(r)}function z(r){var i,o,T,y;M.list.push({fromId:(i=v.info)==null?void 0:i.id,toId:(o=u.value)==null?void 0:o.userId,avatar:(T=v.info)==null?void 0:T.headImg,nickName:(y=v.info)==null?void 0:y.nickName,createTime:se().format("YYYY-MM-DD HH:mm:ss"),...r}),V()}const V=he(()=>{X(()=>{const r=document.querySelector(".cl-chat .chat-message .list");r==null||r.scroll({top:1e5+Math.random(),behavior:"smooth"})})},300);async function S(){await u.get(),await M.get(),V()}return me("chat",{send:k,append:z,expand:s,scrollToBottom:V}),n(()=>{h.value=!m.isMini}),f({open:g,close:d}),(r,i)=>{const o=l("cl-svg"),T=l("el-badge"),y=l("el-icon"),B=l("cl-dialog");return _(),C(q,null,[e("div",{class:"cl-chat__icon",onClick:g},[t(T,{value:I.value,hidden:!I.value},{default:c(()=>[t(o,{name:"icon-notice",size:16})]),_:1},8,["value","hidden"])]),t(B,{modelValue:w.value,"onUpdate:modelValue":i[2]||(i[2]=N=>w.value=N),title:"聊天窗口",height:"70vh",width:"1200px",padding:"0","keep-alive":"",scrollbar:!1,"close-on-click-modal":!1,"close-on-press-escape":"",controls:["slot-expand","cl-flex1","fullscreen","close"]},{"slot-expand":c(()=>[e("button",Ze,[h.value?(_(),F(y,{key:1,onClick:i[1]||(i[1]=N=>h.value=!1)},{default:c(()=>[t(a(de))]),_:1})):(_(),F(y,{key:0,onClick:i[0]||(i[0]=N=>h.value=!0)},{default:c(()=>[t(a(ue))]),_:1}))])]),default:c(()=>[e("div",{class:R(["cl-chat",{"is-mini":a(m).isMini,"is-expand":h.value}])},[e("div",Ge,[t(Ae)]),e("div",Qe,[t(qe)])],2)]),_:1},8,["modelValue"])],64)}}});export{es as default};
