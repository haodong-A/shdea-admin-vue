import{i as h}from"./comm-DyJRlPK0.js";import{o as O,h as u}from"./index-CmZ4zCGF.js";import"./store@2.0.12-RoMfFez2.js";import{a as B}from"./index-CO9VWbz1.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{v as D}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{d as v,i as e,M as C,o as L,a as P,K as T,L as d,_ as l,a0 as J,P as R}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import W from"./index-DQKPLNU9.js";import{bB as j}from"./lodash-es@4.17.21-D6PnhKvy.js";import{a as H}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{r as K,v as _}from"./@vue_reactivity@3.5.12-vtUNgENk.js";const $=v({name:"cl-filter",props:{label:String},setup(f,{slots:c}){return()=>{var s;return e("div",{class:"cl-filter"},[C(e("span",{class:"cl-filter__label"},[f.label]),[[D,f.label]]),(s=c.default)==null?void 0:s.call(c)])}}}),z=v({name:"cl-spec"}),pe=v({...z,props:{modelValue:{type:[Number,String]}},setup(f){const c=f,s=h.useForm(),{setRefs:k,refs:q}=B(),g=O(),y=[{label:"正常",value:0},{label:"禁用",value:1}],w=K();L(async()=>{const o=await u.goods.field.list({status:1});w.value=o[0].template});function S(o){var p;(p=s.value)==null||p.open({dialog:{},width:"80%",title:"编辑规格",items:[{type:"tabs",props:{type:"",labels:[{label:"基本信息",value:"base"},{label:"规格参数",value:"param"},{label:"详情页",value:"details"}]}},{group:"base",label:"名称",prop:"specName",required:!0,component:{name:"el-input"}},{group:"base",label:"编号",prop:"specModel",required:!0,component:{name:"el-input",prop:{placeholder:"请输入产品编号"}}},{group:"base",label:"类型",prop:"specType",required:!0,component:{name:"el-select",options:g.dict.get("spec-type")}},{group:"base",label:"主图",prop:"mainImage",required:!0,component:{name:"cl-upload"}},{group:"base",label:"副图",prop:"otherImages",component:{name:"cl-goods-other-images"}},{group:"base",label:"起订量-价格",prop:"moqPrices",component:{name:"cl-goods-moq"},rules:{type:"string",trigger:"blur",validator(t,r,a){r&&j(r)&&(JSON.parse(r)||[]).forEach(m=>{const{min:n,max:b}=m.moq;b==0&&a(new Error("起订量最大区间不能为0")),b<n&&a(new Error("起订量最大区间不能小于最小区间"))}),a()}}},{group:"base",label:"提供样品",prop:"haveSample",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}},{group:"base",label:"样品单价",prop:"samplePrice",required:!0,hidden(t){return!t.scope.haveSample},component:{name:"el-input-number",props:{precision:2,placeholder:"请输入样品单价"}}},{group:"base",label:"排序",prop:"order",value:0,component:{name:"el-input-number",props:{min:0}}},{group:"base",label:"状态",prop:"status",dict:y,minWidth:120,component:{name:"cl-switch",props:{inlinePrompt:!0,activeText:"正常",inactiveText:"禁用",style:"--el-switch-on-color: #13ce66; --el-switch-off-color: #ff4949"}}},{group:"param",prop:"specParam",component:{ref:k("params"),name:"cl-parse-input",props:{fieldOptions:w.value}}},{group:"details",prop:"detailPage",component:{name:"cl-editor-wang",props:{height:700}}}],on:{open:async t=>{var r,a;if(o){(r=s.value)==null||r.showLoading();const i=await u.goods.spec.info({id:o});Object.assign(t,i),(a=s.value)==null||a.hideLoading()}},submit:async(t,{done:r,close:a})=>{var n;if(!await q.params.validate()){(n=s.value)==null||n.Tabs.change("param",!1),r();return}const m=t.specParam?JSON.stringify(t.specParam):"";o?await u.goods.spec.update({...t,id:o,infoId:c.modelValue,specParam:m}):await u.goods.spec.add({...t,infoId:c.modelValue,specParam:m}),r(),H.success("保存成功"),a(),N()}}})}const V=h.useTable({autoHeight:!1,contextMenu:["refresh","check","order-desc","order-asc",o=>({label:"编辑",callback(p){S(o.id),p()}})],columns:[{type:"selection"},{label:"规格名称",prop:"specName"},{label:"产品编号",prop:"specModel"},{label:"主图",prop:"mainImage",component:{name:"cl-image"}},{label:"规格类型",prop:"specType",dict:g.dict.get("spec-type")},{label:"状态",prop:"status",dict:y,minWidth:120,component:{name:"cl-switch",props:{inlinePrompt:!0,activeText:"正常",inactiveText:"禁用",style:"--el-switch-on-color: #13ce66; --el-switch-off-color: #ff4949"}}},{label:"排序",prop:"order"}]}),x=h.useCrud({service:u.goods.spec},o=>{o.refresh({infoId:c.modelValue})});function N(){var o;(o=x.value)==null||o.refresh()}return(o,p)=>{const t=l("cl-refresh-btn"),r=l("el-button"),a=l("cl-multi-delete-btn"),i=l("cl-flex1"),m=l("cl-search-key"),n=l("cl-row"),b=l("cl-table"),I=l("cl-pagination"),M=l("cl-form"),E=l("cl-crud"),F=J("permission");return P(),T(E,{ref_key:"CrudSpec",ref:x},{default:d(()=>[e(n,null,{default:d(()=>[e(t),C((P(),T(r,{type:"primary",onClick:p[0]||(p[0]=A=>S())},{default:d(()=>p[1]||(p[1]=[R(" 新增 ")])),_:1})),[[F,_(u).goods.spec.permission.add]]),e(a),e(i),e(_($),null,{default:d(()=>[e(_(W),{prop:"specType",options:_(g).dict.get("spec-type")},null,8,["options"])]),_:1}),e(m,{placeholder:"搜索关键字"})]),_:1}),e(n,null,{default:d(()=>[e(b,{ref_key:"TableSpec",ref:V,stripe:""},null,512)]),_:1}),e(n,null,{default:d(()=>[e(i),e(I)]),_:1}),e(M,{ref_key:"FormSpec",ref:s},null,512)]),_:1},512)}}});export{pe as _};
