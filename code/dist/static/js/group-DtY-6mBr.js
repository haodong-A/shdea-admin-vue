import{l as ne,v as ae}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{U as re,B as ce,M as pe,W as de,n as A,m as ue}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import{a as me,c as fe}from"./index-DjrkcC4y.js";import{u as ve}from"./index-yy2Czm1T.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{i as U}from"./comm-DyJRlPK0.js";import{a as _e,B as he}from"./lodash-es@4.17.21-D6PnhKvy.js";import{a as $,b as ge}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{d as I,J as be,y as ye,o as ke,a as n,c as f,f as a,H as S,i as r,L as d,O as y,K as u,n as Ce,_ as g,a0 as W,M as D,N as xe,F as we,X as Me}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{n as G,r as k,v as m}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{p as H,O as B}from"./@vue_shared@3.5.12-UFe9jxSY.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@braintree_sanitize-url@6.0.4-BB1FEM6a.js";import"./@vueuse_core@11.1.0_vue@3.5.12_typescript@5.5.4_-BKaerpSy.js";import"./@vueuse_shared@11.1.0_vue@3.5.12_typescript@5.5.4_-DXriuop5.js";import"./store@2.0.12-RoMfFez2.js";import"./mitt@3.0.1-C1z4c41a.js";import"./axios@1.7.7-CCb-kr4I.js";import"./nprogress@0.2.0-B8S133N7.js";import"./pinia@2.2.4_typescript@5.5.4_vue@3.5.12_typescript@5.5.4_-CVf9nHlw.js";import"./vue-demi@0.14.10_vue@3.5.12_typescript@5.5.4_-DvPnGcuI.js";import"./vue@3.5.12_typescript@5.5.4-kKmasoJt.js";import"./@bytemd_plugin-math@1.21.0_bytemd@1.21.0-Dc_JUVYX.js";import"./remark-math@5.1.1-C8vps_rM.js";import"./micromark-extension-math@2.1.2-StTlgfH1.js";import"./micromark-factory-space@1.1.0-C57A7NS2.js";import"./micromark-util-character@1.2.0-D-NaLusr.js";import"./katex@0.16.11-CvgdMzdh.js";import"./mdast-util-math@2.0.2-Boy2OOKg.js";import"./longest-streak@3.1.0-BHNUWYJP.js";import"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";import"./micromark-util-decode-string@1.1.0-CdHYbWAu.js";import"./decode-named-character-reference@1.0.2-C3-224fz.js";import"./micromark-util-decode-numeric-character-reference@1.1.0-DRnCnno4.js";import"./vue-router@4.4.5_vue@3.5.12_typescript@5.5.4_-DGEeQixy.js";import"./mockjs@1.1.0-hXCvQ4kl.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.12_echarts@5.5.1_vue@3.5.12_typescript@5.5.4_-tmE62Ovn.js";import"./echarts@5.5.1-D8FyPvXx.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.0-CH1asNwC.js";import"./@vueuse_shared@9.13.0_vue@3.5.12_typescript@5.5.4_-u9BR5ga7.js";import"./@vueuse_core@9.13.0_vue@3.5.12_typescript@5.5.4_-B3H9WZsa.js";import"./@sxzz_popperjs-es@2.11.7-DkudPAZk.js";import"./@ctrl_tinycolor@3.6.1--gef7wIN.js";import"./dayjs@1.11.13-DXimfR00.js";import"./async-validator@4.2.5-DbzRl2Zc.js";import"./memoize-one@6.0.0-DQFWdy6B.js";import"./normalize-wheel-es@1.2.0-D2sExr9L.js";import"./@floating-ui_dom@1.6.11-Db5K7U0i.js";import"./@floating-ui_core@1.6.8-B67JZAQv.js";import"./@floating-ui_utils@0.2.8-BSxVqCX2.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-D8rsWRp7.js";const Se={class:"cl-view-group__wrap"},Be={class:"cl-view-group__left"},Ee={class:"scope"},Ve={class:"head"},ze={key:0,class:"search"},De={class:"data"},Ne={class:"item"},Fe=["infinite-scroll-disabled"],Le=["onClick","onContextmenu"],Oe={class:"cl-view-group__right"},We={class:"head"},je={class:"title"},Ke={key:0,class:"content"},Re=I({name:"cl-view-group"}),Te=I({...Re,setup(qe,{expose:J}){ne(t=>({"6cf7321d":e.leftWidth}));const{browser:E,onScreenChange:P}=me(),X=be(),j=U.useForm(),{refs:Q,setRefs:Y}=ve(),e=G(Object.assign({label:"组",title:"列表",leftWidth:"300px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableKeySearch:!0,enableAdd:!0,custom:!1},ye("useViewGroup__options"))),K=!!X.left;_e(e.service)&&!K&&console.error("<cl-view-group /> 参数 service 不能为空");const N=k(!1),F=k(""),p=k([]),C=k(!0),c=k(),v=G(he({visible:!!e.tree,props:{label:"name",children:"children",disabled:"disabled",isLeaf:"isLeaf",class:""},defaultExpandedKeys:[]},e.tree));function x(t){C.value=t===void 0?!C.value:t}function w(t){t||(t=p.value[0]),c.value=t,Ce(()=>{t&&(E.isMini&&x(!1),e.onSelect&&e.onSelect(t))})}function L(t){var o,l;(l=j.value)==null||l.open({title:(t?"编辑":"添加")+e.label,form:{...t},on:{submit(s,{close:h,done:b}){e.service[t?"update":"add"](s).then(()=>{$.success("保存成功"),t&&Object.assign(t,s),_(),h()}).catch(z=>{$.error(z.message),b()})}},...(o=e.onEdit)==null?void 0:o.call(e,t)})}function R(t){ge.confirm("此操作将会删除选择的数据，是否继续？","提示",{type:"warning"}).then(()=>{function o(l){e.service.delete(l).then(async()=>{var s;$.success("删除成功"),await _(),((s=c.value)==null?void 0:s.id)==t.id&&w()}).catch(s=>{$.error(s.message)})}e.onDelete?e.onDelete(t,{next:o}):o({ids:[t.id]})}).catch(()=>null)}const V={order:"createTime",sort:"asc",page:1,size:50},T=k(!1);async function _(t){if(K)return!1;Object.assign(V,t),N.value=!0;const o={...V,...e.data,keyWord:F.value};let l;v.visible?l=e.service.list(o).then(s=>{p.value=fe(s)}):l=e.service.page(o).then(s=>{var b;const h=((b=e.onData)==null?void 0:b.call(e,s.list))||s.list;V.page==1?p.value=h:p.value.push(...h),T.value=s.pagination.total<=p.value.length}),await l.then(()=>{const s=c.value||p.value[0];s&&(v.visible&&Q.tree.getNode(s).expand(),w(s))}).catch(s=>{$.error(s.message)}),N.value=!1}function Z(){_({page:V.page+1})}function ee(t,o){if(!e.enableContextMenu)return!1;U.ContextMenu.open(t,{hover:{target:"item"},list:[{label:"编辑",hidden:!e.service._permission.update,callback(l){l(),L(o)}},{label:"删除",hidden:!e.service._permission.delete,callback(l){l(),R(o)}}],...e.onContextMenu&&e.onContextMenu(o)})}return P(()=>{x(!E.isMini)}),ke(()=>{_()}),J({list:p,selected:c,isExpand:C,expand:x,select:w,browser:E,edit:L,remove:R,refresh:_}),(t,o)=>{const l=g("el-icon"),s=g("el-tooltip"),h=g("el-input"),b=g("el-tree"),z=g("el-empty"),te=g("el-scrollbar"),oe=g("cl-form"),se=W("permission"),ie=W("infinite-scroll"),le=W("loading");return n(),f("div",{class:H(["cl-view-group",[C.value?"is-expand":"is-collapse"]])},[a("div",Se,[a("div",Be,[S(t.$slots,"left",{},()=>[a("div",Ee,[a("div",Ve,[a("span",null,B(e.label),1),e.enableRefresh?(n(),u(s,{key:0,content:"刷新"},{default:d(()=>[r(l,{onClick:o[0]||(o[0]=i=>_())},{default:d(()=>[r(m(re))]),_:1})]),_:1})):y("",!0),e.enableAdd?(n(),u(s,{key:1,content:"添加"},{default:d(()=>[D((n(),u(l,{onClick:o[1]||(o[1]=i=>L())},{default:d(()=>[r(m(ce))]),_:1})),[[se,e.service.permission.add]])]),_:1})):y("",!0)]),e.enableKeySearch?(n(),f("div",ze,[r(h,{modelValue:F.value,"onUpdate:modelValue":o[2]||(o[2]=i=>F.value=i),placeholder:"搜索关键字",clearable:"","prefix-icon":m(pe),onChange:o[3]||(o[3]=i=>_({page:1}))},null,8,["modelValue","prefix-icon"])])):y("",!0),D((n(),f("div",De,[r(te,null,{default:d(()=>[v.visible?(n(),u(b,{key:0,ref:m(Y)("tree"),class:"tree","highlight-current":"","auto-expand-parent":"","expand-on-click-node":!1,lazy:v.lazy,data:p.value,props:v.props,load:v.onLoad,onNodeClick:w},{default:d(({data:i})=>[a("div",Ne,[i.icon?(n(),u(xe(i.icon),{key:0})):y("",!0),a("span",null,B(i[v.props.label]),1)])]),_:1},8,["lazy","data","props","load"])):D((n(),f("ul",{key:1,class:"list","infinite-scroll-immediate":!1,"infinite-scroll-disabled":T.value},[(n(!0),f(we,null,Me(p.value,(i,O)=>(n(),f("li",{key:O,onClick:M=>w(i),onContextmenu:M=>{ee(M,i)}},[S(t.$slots,"item",{item:i,selected:c.value,index:O},()=>{var M,q;return[a("div",{class:H(["item",{"is-active":((M=c.value)==null?void 0:M.id)==i.id}])},[S(t.$slots,"item-name",{item:i,selected:c.value,index:O},()=>[a("span",null,B(i.name),1)],!0),D(r(l,{class:"arrow-right"},{default:d(()=>[r(m(de))]),_:2},1536),[[ae,((q=c.value)==null?void 0:q.id)==i.id]])],2)]},!0)],40,Le))),128)),p.value.length==0?(n(),u(z,{key:0,"image-size":80})):y("",!0)],8,Fe)),[[ie,Z]])]),_:3})])),[[le,N.value]])])],!0),m(E).isMini?(n(),f("div",{key:0,class:"collapse-btn",onClick:o[4]||(o[4]=i=>x(!1))},[r(l,null,{default:d(()=>[r(m(A))]),_:1})])):y("",!0)]),a("div",Oe,[a("div",We,[a("div",{class:"icon",onClick:o[5]||(o[5]=i=>x())},[C.value?(n(),u(l,{key:0},{default:d(()=>[r(m(ue))]),_:1})):(n(),u(l,{key:1},{default:d(()=>[r(m(A))]),_:1}))]),S(t.$slots,"title",{selected:c.value},()=>{var i;return[a("span",je,B(e.title)+"（"+B(((i=c.value)==null?void 0:i.name)||"未选择")+"） ",1)]},!0)]),c.value||e.custom?(n(),f("div",Ke,[S(t.$slots,"right",{},void 0,!0)])):(n(),u(z,{key:1,"image-size":80}))])]),r(oe,{ref_key:"Form",ref:j},null,512)],2)}}}),qt=$e(Te,[["__scopeId","data-v-8cc57097"]]);export{qt as default};
