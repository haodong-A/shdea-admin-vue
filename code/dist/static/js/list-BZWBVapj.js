import{w as V}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{a as R}from"./index-Ghdj5350.js";import"./store@2.0.12-RoMfFez2.js";import{u as L}from"./index-BEUtcyhA.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{$ as A,a0 as K,a1 as U,P as X,B as j}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import{i as F}from"./comm-DyJRlPK0.js";import{d as q,_ as a,a as p,K as $,L as i,i as s,n as G,R as J,a0 as Q,c as b,f as c,F as H,X as Z,P as I,M as w}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{r as z,n as ee,v as r}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{b as N,a as h}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{O as S,p as te}from"./@vue_shared@3.5.12-UFe9jxSY.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse_core@11.1.0_vue@3.5.12_typescript@5.5.4_-BKaerpSy.js";import"./@vueuse_shared@11.1.0_vue@3.5.12_typescript@5.5.4_-DXriuop5.js";import"./lodash-es@4.17.21-D6PnhKvy.js";import"./mitt@3.0.1-C1z4c41a.js";import"./axios@1.7.7-CCb-kr4I.js";import"./nprogress@0.2.0-B8S133N7.js";import"./@braintree_sanitize-url@6.0.4-BB1FEM6a.js";import"./pinia@2.2.4_typescript@5.5.4_vue@3.5.12_typescript@5.5.4_-CVf9nHlw.js";import"./vue-demi@0.14.10_vue@3.5.12_typescript@5.5.4_-DvPnGcuI.js";import"./vue@3.5.12_typescript@5.5.4-kKmasoJt.js";import"./@bytemd_plugin-math@1.21.0_bytemd@1.21.0-Dc_JUVYX.js";import"./remark-math@5.1.1-C8vps_rM.js";import"./micromark-extension-math@2.1.2-StTlgfH1.js";import"./micromark-factory-space@1.1.0-C57A7NS2.js";import"./micromark-util-character@1.2.0-D-NaLusr.js";import"./katex@0.16.11-CvgdMzdh.js";import"./mdast-util-math@2.0.2-Boy2OOKg.js";import"./longest-streak@3.1.0-BHNUWYJP.js";import"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";import"./micromark-util-decode-string@1.1.0-CdHYbWAu.js";import"./decode-named-character-reference@1.0.2-C3-224fz.js";import"./micromark-util-decode-numeric-character-reference@1.1.0-DRnCnno4.js";import"./vue-router@4.4.5_vue@3.5.12_typescript@5.5.4_-DGEeQixy.js";import"./mockjs@1.1.0-hXCvQ4kl.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.12_echarts@5.5.1_vue@3.5.12_typescript@5.5.4_-tmE62Ovn.js";import"./echarts@5.5.1-D8FyPvXx.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.0-CH1asNwC.js";import"./@vueuse_shared@9.13.0_vue@3.5.12_typescript@5.5.4_-u9BR5ga7.js";import"./@vueuse_core@9.13.0_vue@3.5.12_typescript@5.5.4_-B3H9WZsa.js";import"./@sxzz_popperjs-es@2.11.7-DkudPAZk.js";import"./@ctrl_tinycolor@3.6.1--gef7wIN.js";import"./dayjs@1.11.13-DXimfR00.js";import"./async-validator@4.2.5-DbzRl2Zc.js";import"./memoize-one@6.0.0-DQFWdy6B.js";import"./normalize-wheel-es@1.2.0-D2sExr9L.js";import"./@floating-ui_dom@1.6.11-Db5K7U0i.js";import"./@floating-ui_core@1.6.8-B67JZAQv.js";import"./@floating-ui_utils@0.2.8-BSxVqCX2.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-D8rsWRp7.js";const ne=q({name:"undefined"}),se=q({...ne,setup(O,{expose:n}){const{service:E}=L(),_=z(!1),T=z(""),g=ee({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),M=F.useTable({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:g.status},{label:"执行时间",prop:"createTime",minWidth:170}]}),m=F.useCrud({service:E.task.info,dict:{api:{page:"log"}}});function B(k){_.value=!0,T.value=`日志列表（${k.name}）`,G(()=>{var d;(d=m.value)==null||d.refresh({id:k.id,page:1})})}function D(){_.value=!1}return n({open:B,close:D}),(k,d)=>{const y=a("cl-refresh-btn"),W=a("cl-select"),Y=a("cl-filter"),o=a("cl-row"),e=a("cl-table"),t=a("cl-flex1"),u=a("cl-pagination"),x=a("cl-crud"),C=a("cl-dialog");return p(),$(C,{modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=f=>_.value=f),title:T.value,width:"1000px"},{default:i(()=>[s(x,{ref_key:"Crud",ref:m,padding:"0"},{default:i(()=>[s(o,null,{default:i(()=>[s(y),s(Y,{label:"状态"},{default:i(()=>[s(W,{options:g.status,prop:"status",width:120},null,8,["options"])]),_:1})]),_:1}),s(o,null,{default:i(()=>[s(e,{ref_key:"Table",ref:M},null,512)]),_:1}),s(o,null,{default:i(()=>[s(t),s(u)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),le={class:"list"},ae=["onClick","onContextmenu"],ie={class:"name"},re={class:"row"},pe={class:"row"},ce={class:"status"},me=q({name:"task-list"}),ue=q({...me,setup(O){const{service:n,refs:E,setRefs:_}=L(),{browser:T}=R(),g=F.useForm(),M=z([]);function m(){n.task.info.page({size:100,page:1}).then(o=>{M.value=o.list.map(e=>(e.every&&(e._every=parseInt(String(e.every/1e3))),e))})}function B(o){N.confirm(`此操作将启用任务（${o.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.start({id:o.id,type:o.type}).then(()=>{m()}).catch(e=>{h.error(e.message)})}).catch(()=>null)}function D(o){N.confirm(`此操作将停用任务（${o.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.stop({id:o.id}).then(()=>{m()}).catch(e=>{h.error(e.message)})}).catch(()=>null)}function k(o){N.confirm(`此操作将删除任务（${o.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.delete({ids:[o.id]}).then(()=>{m()}).catch(e=>{h.error(e.message)})}).catch(()=>null)}function d(o){E.log.open(o)}async function y(o){var e;if(o&&!n.task.info._permission.update)return!1;(e=g.value)==null||e.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:t})=>t.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:t})=>t.taskType==0,hook:{bind(t){return t/1e3},submit(t){return t*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始时间",prop:"startDate",hidden:({scope:t})=>t.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...o},on:{submit:(t,{close:u,done:x})=>{t.limit||(t.limit=null),n.task.info[o!=null&&o.id?"update":"add"](t).then(()=>{m(),h.success("保存成功"),u()}).catch(C=>{h.error(C.message),x()})}}})}function W(o){n.task.info.once({id:o.id}).then(()=>{m()}).catch(e=>{h.error(e.message)})}function Y(o,e){F.ContextMenu.open(o,{list:[e.status?{label:"暂停",hidden:!n.task.info._permission.stop,callback(t){D(e),t()}}:{label:"开始",hidden:!n.task.info._permission.start,callback(t){B(e),t()}},{label:"立即执行",hidden:!n.task.info._permission.once,callback(t){W(e),t()}},{label:"编辑",hidden:!(n.task.info._permission.update&&n.task.info._permission.info),callback(t){y(e),t()}},{label:"删除",hidden:!n.task.info._permission.delete,callback(t){k(e),t()}},{label:"查看日志",hidden:!n.task.info._permission.log,callback(t){d(e),t()}}]})}return J(()=>{m()}),(o,e)=>{const t=a("el-tag"),u=a("el-icon"),x=a("cl-flex1"),C=a("cl-form"),f=Q("permission");return p(),b("div",{class:te(["task-list",{"is-mini":r(T).isMini}])},[c("div",le,[(p(!0),b(H,null,Z(M.value,(l,P)=>(p(),b("div",{key:P,class:"item",onClick:v=>y(l),onContextmenu:v=>{Y(v,l)}},[c("p",ie,S(l.name),1),c("p",re,[e[1]||(e[1]=c("span",null,"执行服务",-1)),c("span",null,S(l.service),1)]),c("p",pe,[e[2]||(e[2]=c("span",null,"定时规则",-1)),c("span",null,S(l.taskType==1?`间隔${l._every}秒执行`:l.cron),1)]),c("div",ce,[l.status?(p(),b(H,{key:0},[s(t,{"disable-transitions":"",effect:"dark",type:"success"},{default:i(()=>e[3]||(e[3]=[I("进行中")])),_:1}),w((p(),$(u,{class:"pause",onClick:V(v=>D(l),["stop"])},{default:i(()=>[s(r(A))]),_:2},1032,["onClick"])),[[f,r(n).task.info.permission.stop]])],64)):(p(),b(H,{key:1},[s(t,{"disable-transitions":"",effect:"dark",type:"danger"},{default:i(()=>e[4]||(e[4]=[I("已停止")])),_:1}),w((p(),$(u,{class:"play",onClick:V(v=>B(l),["stop"])},{default:i(()=>[s(r(K))]),_:2},1032,["onClick"])),[[f,r(n).task.info.permission.start]])],64)),s(x),w((p(),$(u,{class:"log",onClick:V(v=>d(l),["stop"])},{default:i(()=>[s(r(U))]),_:2},1032,["onClick"])),[[f,r(n).task.info.permission.log]]),w((p(),$(u,{class:"delete",onClick:V(v=>k(l),["stop"])},{default:i(()=>[s(r(X))]),_:2},1032,["onClick"])),[[f,r(n).task.info.permission.delete]])])],40,ae))),128)),w((p(),b("div",{class:"item is-add",onClick:e[0]||(e[0]=l=>y())},[s(u,null,{default:i(()=>[s(r(j))]),_:1}),e[5]||(e[5]=c("p",null,"添加计划任务",-1))])),[[f,r(n).task.info.permission.add]])]),s(C,{ref_key:"Form",ref:g},null,512),s(se,{ref:r(_)("log")},null,512)],2)}}}),ut=oe(ue,[["__scopeId","data-v-812eeca4"]]);export{ut as default};
