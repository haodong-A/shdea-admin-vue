import{m as q,s as j,a as A}from"./d3-array@2.12.1-CpYDW9jx.js";import{l as tt}from"./d3-shape@1.3.7-Dr-m8Vax.js";function nt(i){return i.target.depth}function lt(i){return i.depth}function at(i,u){return u-1-i.height}function et(i,u){return i.sourceLinks.length?i.depth:u-1}function dt(i){return i.targetLinks.length?i.depth:i.sourceLinks.length?q(i.sourceLinks,nt)-1:0}function S(i){return function(){return i}}function D(i,u){return v(i.source,u.source)||i.index-u.index}function R(i,u){return v(i.target,u.target)||i.index-u.index}function v(i,u){return i.y0-u.y0}function C(i){return i.value}function ot(i){return i.index}function rt(i){return i.nodes}function it(i){return i.links}function P(i,u){const a=i.get(u);if(!a)throw new Error("missing: "+u);return a}function W({nodes:i}){for(const u of i){let a=u.y0,g=a;for(const d of u.sourceLinks)d.y0=a+d.width/2,a+=d.width;for(const d of u.targetLinks)d.y1=g+d.width/2,g+=d.width}}function gt(){let i=0,u=0,a=1,g=1,d=24,T=8,l,B=ot,N=et,k,h,z=rt,M=it,w=6;function f(){const t={nodes:z.apply(null,arguments),links:M.apply(null,arguments)};return F(t),G(t),J(t),K(t),U(t),W(t),t}f.update=function(t){return W(t),t},f.nodeId=function(t){return arguments.length?(B=typeof t=="function"?t:S(t),f):B},f.nodeAlign=function(t){return arguments.length?(N=typeof t=="function"?t:S(t),f):N},f.nodeSort=function(t){return arguments.length?(k=t,f):k},f.nodeWidth=function(t){return arguments.length?(d=+t,f):d},f.nodePadding=function(t){return arguments.length?(T=l=+t,f):T},f.nodes=function(t){return arguments.length?(z=typeof t=="function"?t:S(t),f):z},f.links=function(t){return arguments.length?(M=typeof t=="function"?t:S(t),f):M},f.linkSort=function(t){return arguments.length?(h=t,f):h},f.size=function(t){return arguments.length?(i=u=0,a=+t[0],g=+t[1],f):[a-i,g-u]},f.extent=function(t){return arguments.length?(i=+t[0][0],a=+t[1][0],u=+t[0][1],g=+t[1][1],f):[[i,u],[a,g]]},f.iterations=function(t){return arguments.length?(w=+t,f):w};function F({nodes:t,links:r}){for(const[o,n]of t.entries())n.index=o,n.sourceLinks=[],n.targetLinks=[];const e=new Map(t.map((o,n)=>[B(o,n,t),o]));for(const[o,n]of r.entries()){n.index=o;let{source:s,target:c}=n;typeof s!="object"&&(s=n.source=P(e,s)),typeof c!="object"&&(c=n.target=P(e,c)),s.sourceLinks.push(n),c.targetLinks.push(n)}if(h!=null)for(const{sourceLinks:o,targetLinks:n}of t)o.sort(h),n.sort(h)}function G({nodes:t}){for(const r of t)r.value=r.fixedValue===void 0?Math.max(j(r.sourceLinks,C),j(r.targetLinks,C)):r.fixedValue}function J({nodes:t}){const r=t.length;let e=new Set(t),o=new Set,n=0;for(;e.size;){for(const s of e){s.depth=n;for(const{target:c}of s.sourceLinks)o.add(c)}if(++n>r)throw new Error("circular link");e=o,o=new Set}}function K({nodes:t}){const r=t.length;let e=new Set(t),o=new Set,n=0;for(;e.size;){for(const s of e){s.height=n;for(const{source:c}of s.targetLinks)o.add(c)}if(++n>r)throw new Error("circular link");e=o,o=new Set}}function O({nodes:t}){const r=A(t,n=>n.depth)+1,e=(a-i-d)/(r-1),o=new Array(r);for(const n of t){const s=Math.max(0,Math.min(r-1,Math.floor(N.call(null,n,r))));n.layer=s,n.x0=i+s*e,n.x1=n.x0+d,o[s]?o[s].push(n):o[s]=[n]}if(k)for(const n of o)n.sort(k);return o}function Q(t){const r=q(t,e=>(g-u-(e.length-1)*l)/j(e,C));for(const e of t){let o=u;for(const n of e){n.y0=o,n.y1=o+n.value*r,o=n.y1+l;for(const s of n.sourceLinks)s.width=s.value*r}o=(g-o+l)/(e.length+1);for(let n=0;n<e.length;++n){const s=e[n];s.y0+=o*(n+1),s.y1+=o*(n+1)}Z(e)}}function U(t){const r=O(t);l=Math.min(T,(g-u)/(A(r,e=>e.length)-1)),Q(r);for(let e=0;e<w;++e){const o=Math.pow(.99,e),n=Math.max(1-o,(e+1)/w);Y(r,o,n),X(r,o,n)}}function X(t,r,e){for(let o=1,n=t.length;o<n;++o){const s=t[o];for(const c of s){let m=0,y=0;for(const{source:L,value:b}of c.targetLinks){let x=b*(c.layer-L.layer);m+=$(L,c)*x,y+=x}if(!(y>0))continue;let p=(m/y-c.y0)*r;c.y0+=p,c.y1+=p,V(c)}k===void 0&&s.sort(v),E(s,e)}}function Y(t,r,e){for(let o=t.length,n=o-2;n>=0;--n){const s=t[n];for(const c of s){let m=0,y=0;for(const{target:L,value:b}of c.sourceLinks){let x=b*(L.layer-c.layer);m+=_(c,L)*x,y+=x}if(!(y>0))continue;let p=(m/y-c.y0)*r;c.y0+=p,c.y1+=p,V(c)}k===void 0&&s.sort(v),E(s,e)}}function E(t,r){const e=t.length>>1,o=t[e];I(t,o.y0-l,e-1,r),H(t,o.y1+l,e+1,r),I(t,g,t.length-1,r),H(t,u,0,r)}function H(t,r,e,o){for(;e<t.length;++e){const n=t[e],s=(r-n.y0)*o;s>1e-6&&(n.y0+=s,n.y1+=s),r=n.y1+l}}function I(t,r,e,o){for(;e>=0;--e){const n=t[e],s=(n.y1-r)*o;s>1e-6&&(n.y0-=s,n.y1-=s),r=n.y0-l}}function V({sourceLinks:t,targetLinks:r}){if(h===void 0){for(const{source:{sourceLinks:e}}of r)e.sort(R);for(const{target:{targetLinks:e}}of t)e.sort(D)}}function Z(t){if(h===void 0)for(const{sourceLinks:r,targetLinks:e}of t)r.sort(R),e.sort(D)}function $(t,r){let e=t.y0-(t.sourceLinks.length-1)*l/2;for(const{target:o,width:n}of t.sourceLinks){if(o===r)break;e+=n+l}for(const{source:o,width:n}of r.targetLinks){if(o===t)break;e-=n}return e}function _(t,r){let e=r.y0-(r.targetLinks.length-1)*l/2;for(const{source:o,width:n}of r.targetLinks){if(o===t)break;e+=n+l}for(const{target:o,width:n}of t.sourceLinks){if(o===r)break;e-=n}return e}return f}function st(i){return[i.source.x1,i.y0]}function ut(i){return[i.target.x0,i.y1]}function ht(){return tt().source(st).target(ut)}export{gt as S,dt as c,et as j,lt as l,at as r,ht as s};
