import{l as te,w as ae}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{V as le}from"./vuedraggable@4.1.0_vue@3.5.12_typescript@5.5.4_-ClfVxlJ-.js";import{a3 as oe,J as se,c as re}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import{i as ie}from"./comm-DyJRlPK0.js";import{u as ue,z as de,g as ne}from"./index-CyAmoSeV.js";import{u as pe}from"./index-4ocppgba.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{b as A,g as T}from"./index-i6JPj4J-.js";import{u as ce}from"./index-CdlxbxLj.js";import me from"./index-Cy_fGNan.js";import{a as M}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{q as I,bv as fe,a as ge}from"./lodash-es@4.17.21-D6PnhKvy.js";import{d as J,b as p,w as ve,a as i,c,f as O,F as be,i as u,L as d,O as b,K as _,n as G,_ as D,H as E,P as he,N as ye}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{r as _e,v as m}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{p as H,O as L}from"./@vue_shared@3.5.12-UFe9jxSY.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./sortablejs@1.14.0-CkefhRDt.js";import"./@braintree_sanitize-url@6.0.4-BB1FEM6a.js";import"./vue@3.5.12_typescript@5.5.4-kKmasoJt.js";import"./@vueuse_core@11.1.0_vue@3.5.12_typescript@5.5.4_-BKaerpSy.js";import"./@vueuse_shared@11.1.0_vue@3.5.12_typescript@5.5.4_-DXriuop5.js";import"./store@2.0.12-RoMfFez2.js";import"./mitt@3.0.1-C1z4c41a.js";import"./axios@1.7.7-CCb-kr4I.js";import"./nprogress@0.2.0-B8S133N7.js";import"./pinia@2.2.4_typescript@5.5.4_vue@3.5.12_typescript@5.5.4_-CVf9nHlw.js";import"./vue-demi@0.14.10_vue@3.5.12_typescript@5.5.4_-DvPnGcuI.js";import"./@bytemd_plugin-math@1.21.0_bytemd@1.21.0-Dc_JUVYX.js";import"./remark-math@5.1.1-C8vps_rM.js";import"./micromark-extension-math@2.1.2-StTlgfH1.js";import"./micromark-factory-space@1.1.0-C57A7NS2.js";import"./micromark-util-character@1.2.0-D-NaLusr.js";import"./katex@0.16.11-CvgdMzdh.js";import"./mdast-util-math@2.0.2-Boy2OOKg.js";import"./longest-streak@3.1.0-BHNUWYJP.js";import"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";import"./micromark-util-decode-string@1.1.0-CdHYbWAu.js";import"./decode-named-character-reference@1.0.2-C3-224fz.js";import"./micromark-util-decode-numeric-character-reference@1.1.0-DRnCnno4.js";import"./vue-router@4.4.5_vue@3.5.12_typescript@5.5.4_-DGEeQixy.js";import"./mockjs@1.1.0-hXCvQ4kl.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.12_echarts@5.5.1_vue@3.5.12_typescript@5.5.4_-tmE62Ovn.js";import"./echarts@5.5.1-D8FyPvXx.js";import"./tslib@2.3.0-BDyQ-Jie.js";import"./zrender@5.6.0-CH1asNwC.js";import"./@vueuse_shared@9.13.0_vue@3.5.12_typescript@5.5.4_-u9BR5ga7.js";import"./@vueuse_core@9.13.0_vue@3.5.12_typescript@5.5.4_-B3H9WZsa.js";import"./@sxzz_popperjs-es@2.11.7-DkudPAZk.js";import"./@ctrl_tinycolor@3.6.1--gef7wIN.js";import"./dayjs@1.11.13-DXimfR00.js";import"./async-validator@4.2.5-DbzRl2Zc.js";import"./memoize-one@6.0.0-DQFWdy6B.js";import"./normalize-wheel-es@1.2.0-D2sExr9L.js";import"./@floating-ui_dom@1.6.11-Db5K7U0i.js";import"./@floating-ui_core@1.6.8-B67JZAQv.js";import"./@floating-ui_utils@0.2.8-BSxVqCX2.js";import"./lodash-unified@1.0.3_@types_lodash-es@4.17.12_lodash-es@4.17.21_lodash@4.17.21-D8rsWRp7.js";const ke={key:0,class:"cl-upload__file-btn"},Be={key:0,class:"cl-upload__footer"},ze={key:0,class:"cl-upload__demo is-dragger"},xe={key:1,class:"cl-upload__demo"},Se={key:0,class:"text"},Ve={class:"cl-upload__item"},Ue=J({name:"cl-upload"}),Ce=J({...Ue,props:{modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},accept:String,multiple:Boolean,limit:Number,limitSize:Number,autoUpload:{type:Boolean,default:!0},size:[String,Number,Array],small:Boolean,icon:null,text:String,showTag:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},draggable:Boolean,drag:Boolean,disabled:Boolean,deletable:Boolean,customClass:String,beforeUpload:Function,prefixPath:String,isEdit:Boolean,scope:Object,prop:String,isDisabled:Boolean},emits:["update:modelValue","change","upload","success","error","progress"],setup(s,{expose:K,emit:Q}){te(e=>({db423be2:R.value[0],db423ba4:R.value[1]}));const o=s,f=Q,{refs:y,setRefs:P}=pe(),{user:W}=ue(),X=ie.useForm(),{options:w,toUpload:Y}=ce(),R=p(()=>{const e=o.size||w.size;return(I(e)?e:[e,e]).map(t=>fe(t)?t+"px":t)}),g=p(()=>o.isDisabled||o.disabled),j=o.limit||w.limit.upload,k=o.limitSize||w.limit.size,B=p(()=>{if(o.text!==void 0)return o.text;switch(o.type){case"file":return"选择文件";case"image":return"选择图片";default:return""}}),z=p(()=>({Authorization:W.token})),r=_e([]),Z=p(()=>o.type=="file"?o.showFileList?!ge(r.value):!1:!0),x=p(()=>o.accept||(o.type=="file"?"":"image/*")),S=p(()=>{const e=r.value.length;return o.multiple&&!g.value?j-e>0:e==0});async function V(e,t){function a(){const l={uid:e.uid,size:e.size,name:e.name,type:T(e.name),progress:o.autoUpload?0:100,url:"",preload:"",error:""};if(l.type=="image"&&e instanceof File&&(l.preload=window.webkitURL.createObjectURL(e)),f("upload",l,e),t)Object.assign(t,l);else if(o.multiple)if(S.value)r.value.push(l);else return M.warning(`最多只能上传${j}个文件`),!1;else r.value=[l];return!0}if(o.beforeUpload){let l=o.beforeUpload(e,t,{next:a});return de(l)?l.then(a).catch(()=>null):l&&(l=a()),l}else return e.size/1024/1024>=k?(M.error(`上传文件大小不能超过 ${k}MB!`),!1):a()}function U(e){r.value.splice(e,1),N()}function q(){r.value=[]}async function C(e,t){if(t||(t=r.value.find(a=>a.uid==e.file.uid)),!t)return!1;Y(e.file,{prefixPath:o.prefixPath,onProgress(a){t.progress=a,f("progress",t)}}).then(a=>{Object.assign(t,a),f("success",t),N()}).catch(a=>{t.error=a.message,f("error",t)})}function F(){return r.value.find(e=>!e.url)}function N(){if(!F()){const e=A(r.value),t=o.multiple?A(r.value):e[0]||"";f("update:modelValue",t),f("change",t),G(()=>{var a,l;o.prop&&((a=X.value)==null||a.validateField(o.prop)),(l=y.upload)==null||l.clearFiles()})}}function ee(e){var t;q(),(t=y.upload)==null||t.clearFiles(),G(()=>{var a,l;(a=y.upload)==null||a.handleStart(e),(l=y.upload)==null||l.submit()})}return ve(()=>o.modelValue,e=>{if(F())return!1;const t=(I(e)?e:[e]).filter(Boolean);r.value=t.map((a,l)=>{const n=r.value[l]||{};return Object.assign({progress:100,uid:ne()},n,{type:T(a),url:a,preload:n.url==a?n.preload:a})}).filter((a,l)=>o.multiple?!0:l==0)},{immediate:!0}),K({isAdd:S,list:r,check:F,clear:q,remove:U,upload:ee}),(e,t)=>{const a=D("el-button"),l=D("el-upload"),n=D("el-icon");return i(),c("div",{class:H(["cl-upload__wrap",[s.customClass]])},[O("div",{class:H(["cl-upload",[`cl-upload--${s.type}`,{"is-disabled":g.value,"is-multiple":s.multiple,"is-small":s.small}]])},[s.drag?b("",!0):(i(),c(be,{key:0},[s.type=="file"?(i(),c("div",ke,[u(l,{ref:m(P)("upload"),drag:s.drag,action:"",accept:x.value,"show-file-list":!1,"before-upload":V,"http-request":C,headers:z.value,multiple:s.multiple,disabled:g.value},{default:d(()=>[E(e.$slots,"default",{},()=>[u(a,{type:"success"},{default:d(()=>[he(L(B.value),1)]),_:1})],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):b("",!0)],64)),Z.value?(i(),_(m(le),{key:1,modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=v=>r.value=v),class:"cl-upload__list",tag:"div","ghost-class":"Ghost","drag-class":"Drag","item-key":"uid",disabled:!s.draggable,onEnd:N},{footer:d(()=>[(s.type=="image"||s.drag)&&S.value?(i(),c("div",Be,[u(l,{ref:m(P)("upload"),action:"",drag:s.drag,accept:x.value,"show-file-list":!1,"before-upload":V,"http-request":C,headers:z.value,multiple:s.multiple,disabled:g.value},{default:d(()=>[E(e.$slots,"default",{},()=>[s.drag?(i(),c("div",ze,[u(n,{size:46},{default:d(()=>[u(m(oe))]),_:1}),O("div",null," 点击上传或将文件拖动到此处，文件大小限制"+L(m(k))+"M ",1)])):(i(),c("div",xe,[u(n,{size:36},{default:d(()=>[s.icon?(i(),_(ye(s.icon),{key:0})):(i(),_(m(se),{key:1}))]),_:1}),B.value?(i(),c("span",Se,L(B.value),1)):b("",!0)]))],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):b("",!0)]),item:d(({element:v,index:$})=>[u(l,{action:"",accept:x.value,"show-file-list":!1,"http-request":h=>C(h,v),"before-upload":h=>{V(h,v)},headers:z.value,disabled:g.value},{default:d(()=>[E(e.$slots,"item",{item:v,index:$},()=>[O("div",Ve,[u(me,{"show-tag":s.showTag,item:v,list:r.value,disabled:g.value,deletable:s.deletable,onRemove:h=>U($)},null,8,["show-tag","item","list","disabled","deletable","onRemove"]),s.small?(i(),_(n,{key:0,class:"cl-upload__item-remove",onClick:ae(h=>U($),["stop"])},{default:d(()=>[u(m(re))]),_:2},1032,["onClick"])):b("",!0)])],!0)]),_:2},1032,["accept","http-request","before-upload","headers","disabled"])]),_:3},8,["modelValue","disabled"])):b("",!0)],2)],2)}}}),Dt=we(Ce,[["__scopeId","data-v-24a7c162"]]);export{Dt as default};
