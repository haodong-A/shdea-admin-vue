import{i as h}from"./comm-DyJRlPK0.js";import{o as E,h as u}from"./index-DjrkcC4y.js";import"./store@2.0.12-RoMfFez2.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{v as F}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{d as v,i as e,M as C,a as S,K as T,L as c,_ as l,a0 as B,P as D}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import L from"./index-DW3D9vE3.js";import{bB as M}from"./lodash-es@4.17.21-D6PnhKvy.js";import{a as O}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{v as _}from"./@vue_reactivity@3.5.12-vtUNgENk.js";const W=v({name:"cl-filter",props:{label:String},setup(d,{slots:s}){return()=>{var a;return e("div",{class:"cl-filter"},[C(e("span",{class:"cl-filter__label"},[d.label]),[[F,d.label]]),(a=s.default)==null?void 0:a.call(s)])}}}),j=v({name:"cl-spec"}),Z=v({...j,props:{modelValue:{type:[Number,String]}},setup(d){const s=d,a=h.useForm(),b=E(),y=[{label:"正常",value:0},{label:"禁用",value:1}];function w(o){var n;(n=a.value)==null||n.open({width:"80%",title:"编辑规格",items:[{type:"tabs",props:{type:"",labels:[{label:"基本信息",value:"base"},{label:"详情页",value:"details"}]}},{group:"base",label:"名称",prop:"specName",required:!0,component:{name:"el-input"}},{group:"base",label:"类型",prop:"specType",required:!0,component:{name:"el-select",options:b.dict.get("spec-type")}},{group:"base",label:"主图",prop:"mainImage",required:!0,component:{name:"cl-upload"}},{group:"base",label:"副图",prop:"otherImages",component:{name:"cl-goods-other-images"}},{group:"base",label:"起订量-价格",prop:"moqPrices",component:{name:"cl-goods-moq"},rules:{type:"string",trigger:"blur",validator(p,t,r){t&&M(t)&&(JSON.parse(t)||[]).forEach(g=>{const{min:m,max:f}=g.moq;f==0&&r(new Error("起订量最大区间不能为0")),f<m&&r(new Error("起订量最大区间不能小于最小区间"))}),r()}}},{group:"base",label:"提供样品",prop:"haveSample",value:1,component:{name:"el-switch",props:{activeValue:1,inactiveValue:0}}},{group:"base",label:"样品单价",prop:"samplePrice",required:!0,hidden(p){return!p.scope.haveSample},component:{name:"el-input-number",props:{precision:2,placeholder:"请输入样品单价"}}},{group:"base",label:"排序",prop:"order",value:0,component:{name:"el-input-number",props:{min:0}}},{group:"base",label:"状态",prop:"status",dict:y,minWidth:120,component:{name:"cl-switch",props:{inlinePrompt:!0,activeText:"正常",inactiveText:"禁用",style:"--el-switch-on-color: #13ce66; --el-switch-off-color: #ff4949"}}},{group:"details",prop:"detailPage",component:{name:"cl-editor-wang",props:{height:700}}}],on:{open:async p=>{var t,r;if(o){(t=a.value)==null||t.showLoading();const i=await u.goods.spec.info({id:o});Object.assign(p,i),(r=a.value)==null||r.hideLoading()}},submit:async(p,{done:t,close:r})=>{console.log(o),o?await u.goods.spec.update({...p,id:o,infoId:s.modelValue}):await u.goods.spec.add({...p,infoId:s.modelValue}),t(),O.success("保存成功"),r(),V()}}})}const k=h.useTable({autoHeight:!1,contextMenu:["refresh","check","order-desc","order-asc",o=>({label:"编辑",callback(n){w(o.id),n()}})],columns:[{type:"selection"},{label:"规格名称",prop:"specName"},{label:"主图",prop:"mainImage",component:{name:"el-image"}},{label:"规格类型",prop:"specType",dict:b.dict.get("spec-type")},{label:"状态",prop:"status",dict:y,minWidth:120,component:{name:"cl-switch",props:{inlinePrompt:!0,activeText:"正常",inactiveText:"禁用",style:"--el-switch-on-color: #13ce66; --el-switch-off-color: #ff4949"}}},{label:"排序",prop:"order"}]}),x=h.useCrud({service:u.goods.spec},o=>{o.refresh({infoId:s.modelValue})});function V(){var o;(o=x.value)==null||o.refresh()}return(o,n)=>{const p=l("cl-refresh-btn"),t=l("el-button"),r=l("cl-multi-delete-btn"),i=l("cl-flex1"),g=l("cl-search-key"),m=l("cl-row"),f=l("cl-table"),q=l("cl-pagination"),I=l("cl-form"),N=l("cl-crud"),P=B("permission");return S(),T(N,{ref_key:"CrudSpec",ref:x},{default:c(()=>[e(m,null,{default:c(()=>[e(p),C((S(),T(t,{type:"primary",onClick:n[0]||(n[0]=H=>w())},{default:c(()=>n[1]||(n[1]=[D(" 新增 ")])),_:1})),[[P,_(u).goods.spec.permission.add]]),e(r),e(i),e(_(W),null,{default:c(()=>[e(_(L),{prop:"specType",options:_(b).dict.get("spec-type")},null,8,["options"])]),_:1}),e(g,{placeholder:"搜索关键字"})]),_:1}),e(m,null,{default:c(()=>[e(f,{ref_key:"TableSpec",ref:k,stripe:""},null,512)]),_:1}),e(m,null,{default:c(()=>[e(i),e(q)]),_:1}),e(I,{ref_key:"FormSpec",ref:a},null,512)]),_:1},512)}}});export{W as C,Z as _};
