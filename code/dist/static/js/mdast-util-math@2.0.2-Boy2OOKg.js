import{l as p}from"./longest-streak@3.1.0-BHNUWYJP.js";import{t as x,s as F,p as M}from"./mdast-util-to-markdown@1.5.0-D9VzXa1u.js";function g(){return{enter:{mathFlow:m,mathFlowFenceMeta:r,mathText:s},exit:{mathFlow:d,mathFlowFence:l,mathFlowFenceMeta:f,mathFlowValue:n,mathText:w,mathTextData:n}};function m(t){this.enter({type:"math",meta:null,value:"",data:{hName:"div",hProperties:{className:["math","math-display"]},hChildren:[{type:"text",value:""}]}},t)}function r(){this.buffer()}function f(){const t=this.resume(),e=this.stack[this.stack.length-1];e.meta=t}function l(){this.getData("mathFlowInside")||(this.buffer(),this.setData("mathFlowInside",!0))}function d(t){const e=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),a=this.exit(t);a.value=e,a.data.hChildren[0].value=e,this.setData("mathFlowInside")}function s(t){this.enter({type:"inlineMath",value:"",data:{hName:"span",hProperties:{className:["math","math-inline"]},hChildren:[{type:"text",value:""}]}},t),this.buffer()}function w(t){const e=this.resume(),a=this.exit(t);a.value=e,a.data.hChildren[0].value=e}function n(t){this.config.enter.data.call(this,t),this.config.exit.data.call(this,t)}}function k(m){let r=(m||{}).singleDollarTextMath;return r==null&&(r=!0),l.peek=d,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:r?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:f,inlineMath:l}};function f(s,w,n,t){const e=s.value||"",a=x(t),h="$".repeat(Math.max(p(e,"$")+1,2)),c=n.enter("mathFlow");let i=a.move(h);if(s.meta){const o=n.enter("mathFlowMeta");i+=a.move(F(n,s.meta,{before:i,after:`
`,encode:["$"],...a.current()})),o()}return i+=a.move(`
`),e&&(i+=a.move(e+`
`)),i+=a.move(h),c(),i}function l(s,w,n){let t=s.value||"",e=1;for(r||e++;new RegExp("(^|[^$])"+"\\$".repeat(e)+"([^$]|$)").test(t);)e++;const a="$".repeat(e);/[^ \r\n]/.test(t)&&(/^[ \r\n]/.test(t)&&/[ \r\n]$/.test(t)||/^\$|\$$/.test(t))&&(t=" "+t+" ");let h=-1;for(;++h<n.unsafe.length;){const c=n.unsafe[h],i=M(c);let o;if(c.atBreak)for(;o=i.exec(t);){let u=o.index;t.codePointAt(u)===10&&t.codePointAt(u-1)===13&&u--,t=t.slice(0,u)+" "+t.slice(o.index+1)}}return a+t+a}function d(){return"$"}}export{g as a,k as m};
