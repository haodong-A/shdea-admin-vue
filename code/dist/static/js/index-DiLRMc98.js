import{m as A,u as D,g as M,h as u}from"./index-CmZ4zCGF.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{p as k}from"./index-BnnXMOBw.js";import{B as O}from"./lodash-es@4.17.21-D6PnhKvy.js";import{a as w}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";function z(){const{options:d}=A.get("upload"),{user:g}=D();async function x(m,S={}){return new Promise((U,r)=>{(async()=>{const{prefixPath:I,onProgress:e}=O({},d,S),f=M("");try{const{mode:i,type:h}=await u.base.comm.uploadMode(),s=i=="local",y=f+"_"+m.name;let t=s?y:k(I,y);const n=async({host:o,preview:v,data:b})=>{const c=new FormData;c.append("key",t);for(const a in b)c.has(a)||c.append(a,b[a]);c.append("file",m);let l=0;await u.request({url:o,method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:s?g.token:null},timeout:6e5,data:c,onUploadProgress(a){l=a.total?Math.floor(a.loaded/a.total*100):0,e==null||e(l)},proxy:s,NProgress:!1}).then(a=>{l!=100&&(e==null||e(100)),t=encodeURIComponent(t);let p="";s?p=a:p=k(v||o,t),U({key:t,url:p,fileId:f})}).catch(a=>{w.error(a.message),r(a)})};s?n({host:"/admin/base/comm/upload"}):u.base.comm.upload(h=="aws"?{key:t}:{}).then(o=>{switch(h){case"cos":n({host:o.url,data:o.credentials});break;case"oss":n({host:o.host,preview:o.publicDomain,data:{OSSAccessKeyId:o.OSSAccessKeyId,policy:o.policy,signature:o.signature}});break;case"qiniu":n({host:o.uploadUrl,preview:o.publicDomain,data:{token:o.token}});break;case"aws":n({host:o.url,data:o.fields});break}}).catch(r)}catch(i){w.error("文件上传失败"),console.error("[upload]",i),r(i)}})()})}return{options:d,toUpload:x}}export{z as u};
