import{b as O,N as k,I as bt,T as d,c as N,P as et,d as yt}from"./@lezer_common@1.2.3-CP7NCNqd.js";import{j as D,a as vt,S as Pt,F as v,P as St,k as xt,h as Tt}from"./@codemirror_state@6.4.1-BMFlvjVs.js";import{E as B,a as I,D as J,V as nt,l as At}from"./@codemirror_view@6.34.3-jfwbSA-b.js";import{a as It,t as f,s as Ct,h as Nt}from"./@lezer_highlight@1.2.1-DwVMghhY.js";import{S as K}from"./style-mod@4.1.2-Bc2inJdb.js";var F;const y=new k;function it(s){return v.define({combine:s?t=>t.concat(s):void 0})}const Dt=new k;class g{constructor(t,e,n=[],i=""){this.data=t,this.name=i,D.prototype.hasOwnProperty("tree")||Object.defineProperty(D.prototype,"tree",{get(){return b(this)}}),this.parser=e,this.extension=[T.of(this),D.languageData.of((r,a,l)=>{let o=Q(r,a,l),h=o.type.prop(y);if(!h)return[];let u=r.facet(h),c=o.type.prop(Dt);if(c){let m=o.resolve(a-o.from,l);for(let p of c)if(p.test(m,r)){let w=r.facet(p.facet);return p.type=="replace"?w:w.concat(u)}}return u})].concat(n)}isActiveAt(t,e,n=-1){return Q(t,e,n).type.prop(y)==this.data}findRegions(t){let e=t.facet(T);if((e==null?void 0:e.data)==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let n=[],i=(r,a)=>{if(r.prop(y)==this.data){n.push({from:a,to:a+r.length});return}let l=r.prop(k.mounted);if(l){if(l.tree.prop(y)==this.data){if(l.overlay)for(let o of l.overlay)n.push({from:o.from+a,to:o.to+a});else n.push({from:a,to:a+r.length});return}else if(l.overlay){let o=n.length;if(i(l.tree,l.overlay[0].from+a),n.length>o)return}}for(let o=0;o<r.children.length;o++){let h=r.children[o];h instanceof d&&i(h,r.positions[o]+a)}};return i(b(t),0),n}get allowsNesting(){return!0}}g.setState=vt.define();function Q(s,t,e){let n=s.facet(T),i=b(s).topNode;if(!n||n.allowsNesting)for(let r=i;r;r=r.enter(t,e,bt.ExcludeBuffers))r.type.isTop&&(i=r);return i}class j extends g{constructor(t,e,n){super(t,e,[],n),this.parser=e}static define(t){let e=it(t.languageData);return new j(e,t.parser.configure({props:[y.add(n=>n.isTop?e:void 0)]}),t.name)}configure(t,e){return new j(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function b(s){let t=s.field(g.state,!1);return t?t.tree:d.empty}class Bt{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let n=this.cursorPos-this.string.length;return t<n||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-n,e-n)}}let A=null;class S{constructor(t,e,n=[],i,r,a,l,o){this.parser=t,this.state=e,this.fragments=n,this.tree=i,this.treeLen=r,this.viewport=a,this.skipped=l,this.scheduleOn=o,this.parse=null,this.tempSkipped=[]}static create(t,e,n){return new S(t,e,[],d.empty,0,n,[],null)}startParse(){return this.parser.startParse(new Bt(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=d.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof t=="number"){let i=Date.now()+t;t=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(N.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(N.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=A;A=this;try{return t()}finally{A=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=X(t,e.from,e.to);return t}changes(t,e){let{fragments:n,tree:i,treeLen:r,viewport:a,skipped:l}=this;if(this.takeTree(),!t.empty){let o=[];if(t.iterChangedRanges((h,u,c,m)=>o.push({fromA:h,toA:u,fromB:c,toB:m})),n=N.applyChanges(n,o),i=d.empty,r=0,a={from:t.mapPos(a.from,-1),to:t.mapPos(a.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let u=t.mapPos(h.from,1),c=t.mapPos(h.to,-1);u<c&&l.push({from:u,to:c})}}}return new S(this.parser,e,n,i,r,a,l,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:i,to:r}=this.skipped[n];i<t.to&&r>t.from&&(this.fragments=X(this.fragments,i,r),this.skipped.splice(n--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends et{createParse(e,n,i){let r=i[0].from,a=i[i.length-1].to;return{parsedPos:r,advance(){let o=A;if(o){for(let h of i)o.tempSkipped.push(h);t&&(o.scheduleOn=o.scheduleOn?Promise.all([o.scheduleOn,t]):t)}return this.parsedPos=a,new d(O.none,[],[],a-r)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return A}}function X(s,t,e){return N.applyChanges(s,[{fromA:t,toA:e,fromB:t,toB:e}])}class x{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),n=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,n)||e.takeTree(),new x(e)}static init(t){let e=Math.min(3e3,t.doc.length),n=S.create(t.facet(T).parser,t,{from:0,to:e});return n.work(20,e)||n.takeTree(),new x(n)}}g.state=Pt.define({create:x.init,update(s,t){for(let e of t.effects)if(e.is(g.setState))return e.value;return t.startState.facet(T)!=t.state.facet(T)?x.init(t.state):s.apply(t)}});let st=s=>{let t=setTimeout(()=>s(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(st=s=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(s,{timeout:400})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const R=typeof navigator<"u"&&(!((F=navigator.scheduling)===null||F===void 0)&&F.isInputPending)?()=>navigator.scheduling.isInputPending():null,Lt=nt.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(g.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(g.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=st(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,r=n.field(g.state);if(r.tree==r.context.tree&&r.context.isDone(i+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,t&&!R?Math.max(25,t.timeRemaining()-5):1e9),l=r.context.treeLen<i&&n.doc.length>i+1e3,o=r.context.work(()=>R&&R()||Date.now()>a,i+(l?0:1e5));this.chunkBudget-=Date.now()-e,(o||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:g.setState.of(new x(r.context))})),this.chunkBudget>0&&!(o&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>At(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),T=v.define({combine(s){return s.length?s[0]:null},enables:s=>[g.state,Lt,B.contentAttributes.compute([s],t=>{let e=t.facet(s);return e&&e.name?{"data-language":e.name}:{}})]});class oe{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}class rt{constructor(t,e,n,i,r,a=void 0){this.name=t,this.alias=e,this.extensions=n,this.filename=i,this.loadFunc=r,this.support=a,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(t=>this.support=t,t=>{throw this.loading=null,t}))}static of(t){let{load:e,support:n}=t;if(!e){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(n)}return new rt(t.name,(t.alias||[]).concat(t.name).map(i=>i.toLowerCase()),t.extensions||[],t.filename,e,n)}static matchFilename(t,e){for(let i of t)if(i.filename&&i.filename.test(e))return i;let n=/\.([^.]+)$/.exec(e);if(n){for(let i of t)if(i.extensions.indexOf(n[1])>-1)return i}return null}static matchLanguageName(t,e,n=!0){e=e.toLowerCase();for(let i of t)if(i.alias.some(r=>r==e))return i;if(n)for(let i of t)for(let r of i.alias){let a=e.indexOf(r);if(a>-1&&(r.length>2||!/\w/.test(e[a-1])&&!/\w/.test(e[a+r.length])))return i}return null}}const at=v.define(),ot=v.define({combine:s=>{if(!s.length)return"  ";let t=s[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return t}});function L(s){let t=s.facet(ot);return t.charCodeAt(0)==9?s.tabSize*t.length:t.length}function le(s,t){let e="",n=s.tabSize,i=s.facet(ot)[0];if(i=="	"){for(;t>=n;)e+="	",t-=n;i=" "}for(let r=0;r<t;r++)e+=i;return e}function he(s,t){s instanceof D&&(s=new lt(s));for(let n of s.state.facet(at)){let i=n(s,t);if(i!==void 0)return i}let e=b(s.state);return e.length>=t?Et(s,e,t):null}class lt{constructor(t,e={}){this.state=t,this.options=e,this.unit=L(t)}lineAt(t,e=1){let n=this.state.doc.lineAt(t),{simulateBreak:i,simulateDoubleBreak:r}=this.options;return i!=null&&i>=n.from&&i<=n.to?r&&i==t?{text:"",from:t}:(e<0?i<t:i<=t)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(t,e);return n.slice(t-i,Math.min(n.length,t+100-i))}column(t,e=1){let{text:n,from:i}=this.lineAt(t,e),r=this.countColumn(n,t-i),a=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return a>-1&&(r+=a-this.countColumn(n,n.search(/\S|$/))),r}countColumn(t,e=t.length){return Tt(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:n,from:i}=this.lineAt(t,e),r=this.options.overrideIndentation;if(r){let a=r(i);if(a>-1)return a}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Ot=new k;function Et(s,t,e){let n=t.resolveStack(e),i=n.node.enterUnfinishedNodesBefore(e);if(i!=n.node){let r=[];for(let a=i;a!=n.node;a=a.parent)r.push(a);for(let a=r.length-1;a>=0;a--)n={node:r[a],next:n}}return ht(n,s,e)}function ht(s,t,e){for(let n=s;n;n=n.next){let i=Ft(n.node);if(i)return i($.create(t,e,n))}return 0}function Mt(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function Ft(s){let t=s.type.prop(Ot);if(t)return t;let e=s.firstChild,n;if(e&&(n=e.type.prop(k.closedBy))){let i=s.lastChild,r=i&&n.indexOf(i.name)>-1;return a=>ut(a,!0,1,void 0,r&&!Mt(a)?i.from:void 0)}return s.parent==null?Rt:null}function Rt(){return 0}class $ extends lt{constructor(t,e,n){super(t.state,t.options),this.base=t,this.pos=e,this.context=n}get node(){return this.context.node}static create(t,e,n){return new $(t,e,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let n=t.resolve(e.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(Wt(n,t))break;e=this.state.doc.lineAt(n.from)}return this.lineIndent(e.from)}continue(){return ht(this.context.next,this.base,this.pos)}}function Wt(s,t){for(let e=t;e;e=e.parent)if(s==e)return!0;return!1}function Ht(s){let t=s.node,e=t.childAfter(t.from),n=t.lastChild;if(!e)return null;let i=s.options.simulateBreak,r=s.state.doc.lineAt(e.from),a=i==null||i<=r.from?r.to:Math.min(r.to,i);for(let l=e.to;;){let o=t.childAfter(l);if(!o||o==n)return null;if(!o.type.isSkipped){if(o.from>=a)return null;let h=/^ */.exec(r.text.slice(e.to-r.from))[0].length;return{from:e.from,to:e.to+h}}l=o.to}}function ue({closing:s,align:t=!0,units:e=1}){return n=>ut(n,t,e,s)}function ut(s,t,e,n,i){let r=s.textAfter,a=r.match(/^\s*/)[0].length,l=n&&r.slice(a,a+n.length)==n||i==s.pos+a,o=t?Ht(s):null;return o?l?s.column(o.from):s.column(o.to):s.baseIndent+(l?0:s.unit*e)}const fe=s=>s.baseIndent;function ce({except:s,units:t=1}={}){return e=>{let n=s&&s.test(e.textAfter);return e.baseIndent+(n?0:t*e.unit)}}const de=v.define(),pe=new k;function ge(s){let t=s.firstChild,e=s.lastChild;return t&&t.to<e.from?{from:t.to,to:e.type.isError?s.to:e.from}:null}class E{constructor(t,e){this.specs=t;let n;function i(l){let o=K.newName();return(n||(n=Object.create(null)))["."+o]=l,o}const r=typeof e.all=="string"?e.all:e.all?i(e.all):void 0,a=e.scope;this.scope=a instanceof g?l=>l.prop(y)==a.data:a?l=>l==a:void 0,this.style=It(t.map(l=>({tag:l.tag,class:l.class||i(Object.assign({},l,{tag:null}))})),{all:r}).style,this.module=n?new K(n):null,this.themeType=e.themeType}static define(t,e){return new E(t,e||{})}}const V=v.define(),jt=v.define({combine(s){return s.length?[s[0]]:null}});function W(s){let t=s.facet(V);return t.length?t:s.facet(jt)}function me(s,t){let e=[Ut],n;return s instanceof E&&(s.module&&e.push(B.styleModule.of(s.module)),n=s.themeType),n?e.push(V.computeN([B.darkTheme],i=>i.facet(B.darkTheme)==(n=="dark")?[s]:[])):e.push(V.of(s)),e}class Vt{constructor(t){this.markCache=Object.create(null),this.tree=b(t.state),this.decorations=this.buildDeco(t,W(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=b(t.state),n=W(t.state),i=n!=W(t.startState),{viewport:r}=t.view,a=t.changes.mapPos(this.decoratedTo,1);e.length<r.to&&!i&&e.type==this.tree.type&&a>=r.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=a):(e!=this.tree||t.viewportChanged||i)&&(this.tree=e,this.decorations=this.buildDeco(t.view,n),this.decoratedTo=r.to)}buildDeco(t,e){if(!e||!this.tree.length)return I.none;let n=new xt;for(let{from:i,to:r}of t.visibleRanges)Nt(this.tree,e,(a,l,o)=>{n.add(a,l,this.markCache[o]||(this.markCache[o]=I.mark({class:o})))},i,r);return n.finish()}}const Ut=St.high(nt.fromClass(Vt,{decorations:s=>s.decorations}));f.meta,f.link,f.heading,f.emphasis,f.strong,f.strikethrough,f.keyword,f.atom,f.bool,f.url,f.contentSeparator,f.labelName,f.literal,f.inserted,f.string,f.deleted,f.regexp,f.escape,f.string,f.variableName,f.variableName,f.typeName,f.namespace,f.className,f.variableName,f.macroName,f.propertyName,f.comment,f.invalid;const zt=1e4,$t="()[]{}",qt=new k;function U(s,t,e){let n=s.prop(t<0?k.openedBy:k.closedBy);if(n)return n;if(s.name.length==1){let i=e.indexOf(s.name);if(i>-1&&i%2==(t<0?1:0))return[e[i+t]]}return null}function z(s){let t=s.type.prop(qt);return t?t(s.node):s}function ke(s,t,e,n={}){let i=n.maxScanDistance||zt,r=n.brackets||$t,a=b(s),l=a.resolveInner(t,e);for(let o=l;o;o=o.parent){let h=U(o.type,e,r);if(h&&o.from<o.to){let u=z(o);if(u&&(e>0?t>=u.from&&t<u.to:t>u.from&&t<=u.to))return Gt(s,t,e,o,u,h,r)}}return Jt(s,t,e,a,l.type,i,r)}function Gt(s,t,e,n,i,r,a){let l=n.parent,o={from:i.from,to:i.to},h=0,u=l==null?void 0:l.cursor();if(u&&(e<0?u.childBefore(n.from):u.childAfter(n.to)))do if(e<0?u.to<=n.from:u.from>=n.to){if(h==0&&r.indexOf(u.type.name)>-1&&u.from<u.to){let c=z(u);return{start:o,end:c?{from:c.from,to:c.to}:void 0,matched:!0}}else if(U(u.type,e,a))h++;else if(U(u.type,-e,a)){if(h==0){let c=z(u);return{start:o,end:c&&c.from<c.to?{from:c.from,to:c.to}:void 0,matched:!1}}h--}}while(e<0?u.prevSibling():u.nextSibling());return{start:o,matched:!1}}function Jt(s,t,e,n,i,r,a){let l=e<0?s.sliceDoc(t-1,t):s.sliceDoc(t,t+1),o=a.indexOf(l);if(o<0||o%2==0!=e>0)return null;let h={from:e<0?t-1:t,to:e>0?t+1:t},u=s.doc.iterRange(t,e>0?s.doc.length:0),c=0;for(let m=0;!u.next().done&&m<=r;){let p=u.value;e<0&&(m+=p.length);let w=t+m*e;for(let P=e>0?0:p.length-1,wt=e>0?p.length:-1;P!=wt;P+=e){let M=a.indexOf(p[P]);if(!(M<0||n.resolveInner(w+P,1).type!=i))if(M%2==0==e>0)c++;else{if(c==1)return{start:h,end:{from:w+P,to:w+P+1},matched:M>>1==o>>1};c--}}e>0&&(m+=p.length)}return u.done?{start:h,matched:!1}:null}function Y(s,t,e,n=0,i=0){t==null&&(t=s.search(/[^\s\u00a0]/),t==-1&&(t=s.length));let r=i;for(let a=n;a<t;a++)s.charCodeAt(a)==9?r+=e-r%e:r++;return r}class ft{constructor(t,e,n,i){this.string=t,this.tabSize=e,this.indentUnit=n,this.overrideIndent=i,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e=this.string.charAt(this.pos),n;if(typeof t=="string"?n=e==t:n=e&&(t instanceof RegExp?t.test(e):t(e)),n)return++this.pos,e}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Y(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var t;return(t=this.overrideIndent)!==null&&t!==void 0?t:Y(this.string,null,this.tabSize)}match(t,e,n){if(typeof t=="string"){let i=a=>n?a.toLowerCase():a,r=this.string.substr(this.pos,t.length);return i(r)==i(t)?(e!==!1&&(this.pos+=t.length),!0):null}else{let i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&e!==!1&&(this.pos+=i[0].length),i)}}current(){return this.string.slice(this.start,this.pos)}}function Kt(s){return{name:s.name||"",token:s.token,blankLine:s.blankLine||(()=>{}),startState:s.startState||(()=>!0),copyState:s.copyState||Qt,indent:s.indent||(()=>null),languageData:s.languageData||{},tokenTable:s.tokenTable||G}}function Qt(s){if(typeof s!="object")return s;let t={};for(let e in s){let n=s[e];t[e]=n instanceof Array?n.slice():n}return t}const Z=new WeakMap;class ct extends g{constructor(t){let e=it(t.languageData),n=Kt(t),i,r=new class extends et{createParse(a,l,o){return new Yt(i,a,l,o)}};super(e,r,[at.of((a,l)=>this.getIndent(a,l))],t.name),this.topNode=te(e),i=this,this.streamParser=n,this.stateAfter=new k({perNode:!0}),this.tokenTable=t.tokenTable?new mt(n.tokenTable):_t}static define(t){return new ct(t)}getIndent(t,e){let n=b(t.state),i=n.resolve(e);for(;i&&i.type!=this.topNode;)i=i.parent;if(!i)return null;let r,{overrideIndentation:a}=t.options;a&&(r=Z.get(t.state),r!=null&&r<e-1e4&&(r=void 0));let l=q(this,n,0,i.from,r??e),o,h;if(l?(h=l.state,o=l.pos+1):(h=this.streamParser.startState(t.unit),o=0),e-o>1e4)return null;for(;o<e;){let c=t.state.doc.lineAt(o),m=Math.min(e,c.to);if(c.length){let p=a?a(c.from):-1,w=new ft(c.text,t.state.tabSize,t.unit,p<0?void 0:p);for(;w.pos<m-c.from;)pt(this.streamParser.token,w,h)}else this.streamParser.blankLine(h,t.unit);if(m==e)break;o=c.to+1}let u=t.lineAt(e);return a&&r==null&&Z.set(t.state,u.from),this.streamParser.indent(h,/^\s*(.*)/.exec(u.text)[1],t)}get allowsNesting(){return!1}}function q(s,t,e,n,i){let r=e>=n&&e+t.length<=i&&t.prop(s.stateAfter);if(r)return{state:s.streamParser.copyState(r),pos:e+t.length};for(let a=t.children.length-1;a>=0;a--){let l=t.children[a],o=e+t.positions[a],h=l instanceof d&&o<i&&q(s,l,o,n,i);if(h)return h}return null}function dt(s,t,e,n,i){if(i&&e<=0&&n>=t.length)return t;!i&&t.type==s.topNode&&(i=!0);for(let r=t.children.length-1;r>=0;r--){let a=t.positions[r],l=t.children[r],o;if(a<n&&l instanceof d){if(!(o=dt(s,l,e-a,n-a,i)))break;return i?new d(t.type,t.children.slice(0,r).concat(o),t.positions.slice(0,r+1),a+o.length):o}}return null}function Xt(s,t,e,n){for(let i of t){let r=i.from+(i.openStart?25:0),a=i.to-(i.openEnd?25:0),l=r<=e&&a>e&&q(s,i.tree,0-i.offset,e,a),o;if(l&&(o=dt(s,i.tree,e+i.offset,l.pos+i.offset,!1)))return{state:l.state,tree:o}}return{state:s.streamParser.startState(n?L(n):4),tree:d.empty}}class Yt{constructor(t,e,n,i){this.lang=t,this.input=e,this.fragments=n,this.ranges=i,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=i[i.length-1].to;let r=S.get(),a=i[0].from,{state:l,tree:o}=Xt(t,n,a,r==null?void 0:r.state);this.state=l,this.parsedPos=this.chunkStart=a+o.length;for(let h=0;h<o.children.length;h++)this.chunks.push(o.children[h]),this.chunkPos.push(o.positions[h]);r&&this.parsedPos<r.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(L(r.state)),r.skipUntilInView(this.parsedPos,r.viewport.from),this.parsedPos=r.viewport.from),this.moveRangeIndex()}advance(){let t=S.get(),e=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),n=Math.min(e,this.chunkStart+2048);for(t&&(n=Math.min(n,t.viewport.to));this.parsedPos<n;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>=t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);if(this.input.lineChunks)e==`
`&&(e="");else{let n=e.indexOf(`
`);n>-1&&(e=e.slice(0,n))}return t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),n=t+e.length;for(let i=this.rangeIndex;;){let r=this.ranges[i].to;if(r>=n||(e=e.slice(0,r-(n-e.length)),i++,i==this.ranges.length))break;let a=this.ranges[i].from,l=this.lineAfter(a);e+=l,n=a+l.length}return{line:e,end:n}}skipGapsTo(t,e,n){for(;;){let i=this.ranges[this.rangeIndex].to,r=t+e;if(n>0?i>r:i>=r)break;let a=this.ranges[++this.rangeIndex].from;e+=a-i}return e}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(t,e,n,i,r){if(this.ranges.length>1){r=this.skipGapsTo(e,r,1),e+=r;let a=this.chunk.length;r=this.skipGapsTo(n,r,-1),n+=r,i+=this.chunk.length-a}return this.chunk.push(t,e,n,i),r}parseLine(t){let{line:e,end:n}=this.nextLine(),i=0,{streamParser:r}=this.lang,a=new ft(e,t?t.state.tabSize:4,t?L(t.state):2);if(a.eol())r.blankLine(this.state,a.indentUnit);else for(;!a.eol();){let l=pt(r.token,a,this.state);if(l&&(i=this.emitToken(this.lang.tokenTable.resolve(l),this.parsedPos+a.start,this.parsedPos+a.pos,4,i)),a.start>1e4)break}this.parsedPos=n,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let t=d.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Zt,topID:0,maxBufferLength:2048,reused:this.chunkReused});t=new d(t.type,t.children,t.positions,t.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(t),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new d(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function pt(s,t,e){t.start=t.pos;for(let n=0;n<10;n++){let i=s(t,e);if(t.pos>t.start)return i}throw new Error("Stream parser failed to advance stream.")}const G=Object.create(null),C=[O.none],Zt=new yt(C),_=[],tt=Object.create(null),gt=Object.create(null);for(let[s,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])gt[s]=kt(G,t);class mt{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),gt)}resolve(t){return t?this.table[t]||(this.table[t]=kt(this.extra,t)):0}}const _t=new mt(G);function H(s,t){_.indexOf(s)>-1||(_.push(s),console.warn(t))}function kt(s,t){let e=[];for(let l of t.split(" ")){let o=[];for(let h of l.split(".")){let u=s[h]||f[h];u?typeof u=="function"?o.length?o=o.map(u):H(h,`Modifier ${h} used at start of tag`):o.length?H(h,`Tag ${h} used as modifier`):o=Array.isArray(u)?u:[u]:H(h,`Unknown highlighting tag ${h}`)}for(let h of o)e.push(h)}if(!e.length)return 0;let n=t.replace(/ /g,"_"),i=n+" "+e.map(l=>l.id),r=tt[i];if(r)return r.id;let a=tt[i]=O.define({id:C.length,name:n,props:[Ct({[n]:e})]});return C.push(a),a.id}function te(s){let t=O.define({id:C.length,name:"Document",props:[y.add(()=>s)],top:!0});return C.push(t),t}J.RTL,J.LTR;export{E as H,lt as I,j as L,S as P,ct as S,le as a,L as b,oe as c,Ot as d,ce as e,fe as f,he as g,ue as h,ot as i,pe as j,ge as k,qt as l,ke as m,Dt as n,it as o,g as p,y as q,de as r,b as s,rt as t,me as u};
