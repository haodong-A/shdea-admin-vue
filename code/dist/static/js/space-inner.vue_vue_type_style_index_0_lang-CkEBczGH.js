import{v as z}from"./@vue_runtime-dom@3.5.12-iSYHT88p.js";import{a3 as J}from"./@element-plus_icons-vue@2.3.1_vue@3.5.12_typescript@5.5.4_-DwlSpvcG.js";import"./index-CmZ4zCGF.js";import"./store@2.0.12-RoMfFez2.js";import{u as Q}from"./index-CO9VWbz1.js";import"./@wangeditor_plugin-link-card@1.0.0_@wangeditor_editor@5.1.23_snabbdom@3.6.2-D_kdJ7Fs.js";import"./@wangeditor_editor@5.1.23-BNs7_II4.js";import{u as W}from"./group-Bd5rxP0u.js";import Y from"./index-CNmpy0ee.js";import{a as y,b as Z}from"./element-plus@2.8.4_vue@3.5.12_typescript@5.5.4_-C7CHjwzj.js";import{d as $,w as ee,a as p,c as m,i as s,L as u,_ as d,C as ae,a0 as te,f as i,P as D,K as N,O as le,M as E,F as ne,X as oe}from"./@vue_runtime-core@3.5.12-Bt7zQ28n.js";import{r as I,n as se,v}from"./@vue_reactivity@3.5.12-vtUNgENk.js";import{p as ie,O as S}from"./@vue_shared@3.5.12-UFe9jxSY.js";const re={class:"cl-upload-space-inner__right"},ce={class:"cl-upload-space-inner__header"},pe={style:{margin:"0px 10px"}},ue=["onClick"],de={class:"cl-upload-space-inner__file-index"},fe={key:1,class:"cl-upload-space-inner__file-empty"},me={class:"cl-upload-space-inner__footer"},ve=$({name:"cl-upload-space-inner"}),Me=$({...ve,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(b,{expose:O,emit:P}){const _=b,T=P,{service:g,browser:x,refs:G,setRefs:U}=Q(),{ViewGroup:V}=W({label:"分类",title:"文件列表",service:g.space.type,onEdit(){return{width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"名称",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}},onSelect(a){f({classifyId:a.id,page:1})}}),h=I(!1),l=I([]),r=I([]),c=se({page:1,size:20,total:0});function j(){l.value=[]}function q(a){var e,t;g.space.info.add({classifyId:(t=(e=V.value)==null?void 0:e.selected)==null?void 0:t.id,...a}).then(o=>{a.id=o.id}).catch(o=>{y.error(o.message)})}function F(a){r.value.unshift(a)}const w={page:1};async function f(a){var e;Object.assign(w,{type:((e=_.accept)==null?void 0:e.split("/")[0].replace("*",""))||void 0,...c,...a}),w.page==1&&(h.value=!0),await g.space.info.page(w).then(t=>{Object.assign(c,t.pagination),r.value=t.list}),h.value=!1}function L(a){const e=l.value.findIndex(t=>t.id===a.id);e>=0?l.value.splice(e,1):_.limit==1?l.value=[a]:l.value.length<_.limit?l.value.push(a):y.warning(`最多只能选择${_.limit}个文件`)}function B(a){return l.value.findIndex(e=>e.id===a)+1}function M(a){const e=a?[a.id]:l.value.map(t=>t.id);Z.confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then(()=>{y.success("删除成功"),e.forEach(t=>{[r.value,l.value].forEach(o=>{const k=o.findIndex(C=>C.id===t);o.splice(k,1)})}),g.space.info.delete({ids:e}).catch(t=>{y.error(t.message)})}).catch(()=>null)}function R(a){a.preventDefault()}function K(a){a.preventDefault(),a.dataTransfer&&a.dataTransfer.files.forEach((e,t)=>{setTimeout(()=>{G.upload.upload(e)},t*10)})}return ee(l,a=>{T("selection-change",a)},{deep:!0}),ae("space",{selection:l,refresh:f,loading:h,list:r}),O({selection:l,open,close,clear:j,refresh:f}),(a,e)=>{const t=d("el-button"),o=d("cl-upload"),k=d("el-icon"),C=d("el-scrollbar"),X=d("el-pagination"),A=d("cl-view-group"),H=te("loading");return p(),m("div",{class:"cl-upload-space-inner",onDragover:R,onDrop:K},[s(A,{ref_key:"ViewGroup",ref:V},{right:u(()=>[i("div",re,[i("div",ce,[s(t,{onClick:e[0]||(e[0]=n=>f({page:1}))},{default:u(()=>e[4]||(e[4]=[D("刷新")])),_:1}),i("div",pe,[s(o,{ref:v(U)("upload"),menu:"space",type:"file",multiple:"","show-file-list":!1,limit:9999,accept:b.accept,onSuccess:q,onUpload:F},{default:u(()=>[s(t,{type:"primary"},{default:u(()=>e[5]||(e[5]=[D("点击上传")])),_:1})]),_:1},8,["accept"])]),b.selectable?le("",!0):(p(),N(t,{key:0,type:"danger",disabled:l.value.length==0,onClick:e[1]||(e[1]=n=>M())},{default:u(()=>e[6]||(e[6]=[D("删除选中文件")])),_:1},8,["disabled"]))]),E((p(),N(C,{class:"cl-upload-space-inner__file"},{default:u(()=>[r.value.length>0?(p(),m("div",{key:0,class:ie(["cl-upload-space-inner__file-list",{"is-mini":v(x).isMini}])},[(p(!0),m(ne,null,oe(r.value,n=>(p(),m("div",{key:n.preload||n.url,class:"cl-upload-space-inner__file-item",onClick:_e=>L(n)},[s(Y,{item:n,list:r.value,onRemove:M},null,8,["item","list"]),E(i("div",de,[i("span",null,S(B(n.id)),1)],512),[[z,B(n.id)]])],8,ue))),128))],2)):(p(),m("div",fe,[s(k,{class:"el-icon--upload"},{default:u(()=>[s(v(J))]),_:1}),e[7]||(e[7]=i("p",null,"将文件拖到此处，或点击按钮上传",-1))]))]),_:1})),[[H,h.value]]),i("div",me,[s(X,{"current-page":c.page,"onUpdate:currentPage":e[2]||(e[2]=n=>c.page=n),small:!!v(x).isMini,total:c.total,"default-page-size":c.size,background:"",layout:"prev, pager, next",onCurrentChange:e[3]||(e[3]=n=>f())},null,8,["current-page","small","total","default-page-size"]),E(i("span",{class:"total"},"共 "+S(c.total)+" 条",513),[[z,!v(x).isMini]])])])]),_:1},512)],32)}}});export{Me as _};
